<?php // Before trying to crack the plugin, please consider buying a pro license at https://www.mapsmarker.com/order - we have put hundreds of hours into the development of the plugin and without honest customers we will not be able to continue the development and support. Thanks for your understanding and your honesty!
if (basename($_SERVER["\123\103\122\111PT_FILENAME"]) == "\154\145\141flet-core.ph\160") { exit ("Ple\141\163\145 do not access\040\164his file dir\145\143\164ly. Than\153\163!<br/><a h\162\145\146='https:\057\057www.mapsma\162\153\145r.com/\147\157\047>www.ma\160\163\155arker.\143\157\155</a>"); } if (is_admin()) { include_once (ABSPATH."wp-a\144\155\151n".DIRECTORY_SEPARATOR."\151\156cludes".DIRECTORY_SEPARATOR."plugin.php"); if (is_plugin_active("leafl\145\164\055maps-marker/\154\145\141flet-maps-\155\141\162ker.php")) { if (!is_multisite()) { deactivate_plugins("\154eaflet-maps-\155\141\162ker/leaflet-\155\141\160s-marker.\160\150\160",$silent=FALSE,$network_wide=NULL); activate_plugin("\154\145aflet-maps-marker\055\160\162o/leaflet\055\155\141ps-marker\056\160\150p",$redirect="plugins.php?\141ctiv\141\164\145=true",$network_wide=FALSE,$silent=FALSE); } else { include_once (ABSPATH."wp-includes".DIRECTORY_SEPARATOR."pluggable.\160\150\160"); if (is_network_admin()) { deactivate_plugins("\154eaflet-maps-marke\162\057\154eaflet-map\163\055\155arker.php",$silent=FALSE,$network_wide=TRUE); activate_plugin("\154\145\141flet-maps-ma\162\153\145r-pro/leaf\154\145\164-maps-mark\145\162\056php",$redirect=FALSE,$network_wide=TRUE,$silent=FALSE); } else { deactivate_plugins("l\145\141\146let-maps-mark\145\162\057leaflet-m\141\160\163-marker.ph\160",$silent=FALSE,$network_wide=NULL); activate_plugin("\154eaflet-maps-mark\145\162\055pro/leafle\164\055\155aps-marke\162\056\160hp",$redirect="\160lugins.php?activa\164\145\075true",$network_wide=FALSE,$silent=FALSE); } } } } define( "l0" ,"a8643486641d"); define( "LEAFLET_WP_ADMIN_URL" ,get_admin_url()); define( "LEAFLET_PLUGIN_URL" ,plugin_dir_url( __FILE__)); define( "LEAFLET_PLUGIN_DIR" ,plugin_dir_path( __FILE__)); $O0=wp_upload_dir(); define( "LEAFLET_PLUGIN_ICONS_URL" ,$O0["\142\141seurl"]."/leaflet-map\163\055\155arker-icon\163"); define( "LEAFLET_PLUGIN_ICONS_DIR" ,$O0["basedir"].DIRECTORY_SEPARATOR."leaflet\055maps-marker\055\151\143ons"); define( "LEAFLET_PLUGIN_QR_URL" ,$O0["\142aseurl"]."/leaflet-maps-m\141\162\153er-qr-codes"); define( "LEAFLET_PLUGIN_QR_DIR" ,$O0["\142\141sedir"].DIRECTORY_SEPARATOR."leafle\164\055\155aps-marker-\161\162\055codes"); define( "l1" ,get_admin_url()); define( "O1" ,plugin_dir_url( __FILE__)); define( "l2" ,plugin_dir_path( __FILE__)); define( "O2" ,$O0["ba\163\145\165rl"]."/leaflet-maps-\155\141\162ker-icons"); define( "l3" ,$O0["basedir"].DIRECTORY_SEPARATOR."le\141\146\154et-maps-marker\055\151\143ons"); if (is_admin()) { require_once (plugin_dir_path( __FILE__)."inc".DIRECTORY_SEPARATOR."\143\154ass-plugin-u\160\144\141te-checker.p\150\160"); } function O3() { if ((substr($_SERVER["REMOTE_\101\104DR"],0,4) == "\06127.") || ($_SERVER["\122EMOTE_ADDR"] == "\072:1")) { return TRUE; } else { return FALSE; } } class l4 { function __construct() { $O4=get_option("\154eafletmapsmarker_\157\160\164ions"); add_action("\151\156it",array( &$this,"\154\155m_load_transla\164\151\157n_files"),1); add_action("\141dmin_init",array( &$this,"\154\155m_load_setti\156\147\163_class"),2); add_action("\141\144\155in_init",array( &$this,"lmm_\151\156\163tall_and_upda\164\145\163"),3); if ( isset ($O4["google_api_deregi\163\164\145r_scripts"]) && ($O4["\147\157ogle_api_der\145\147\151ster_script\163"] == "\145nabled")) { add_action("wp_e\156\161\165eue_scripts",array( &$this,"\154\155\155_deregister_s\143\162\151pts"),4); add_action("\167\160_head",array( &$this,"lmm_deregister\137\163\143ripts"),5); add_action("\151nit",array( &$this,"\154\155m_deregister_sc\162\151\160ts"),6); add_action("wp_footer",array( &$this,"\154\155m_deregister\137\163\143ripts"),7); add_action("wp_print_script\163",array( &$this,"lmm_deregis\164\145\162_scripts"),8); } add_action("\167p_enqueue_scrip\164\163",array( &$this,"lmm_f\162\157\156tend_enqueue_\163\143\162ipts"),011); add_action("wp_pr\151\156\164_styles",array( &$this,"lmm_frontend_enqu\145\165\145_stylesheet\163"),012); add_action("\141dmin_menu",array( &$this,"\154mm_admin_menu"),013); add_action("a\144\155\151n_init",array( &$this,"\154mm_plugin_meta_l\151\156\153s"),014); add_action("wp_ajax_\155\141\160smarker_aja\170\137\141ctions_ba\143\153\145nd",array( &$this,"\154\155\155_ajax_actions\137\142\141ckend"),015); add_action("wp_aj\141\170\137mapsmarker_aja\170\137\141ctions_fron\164\145\156d",array( &$this,"lmm\137\141\152ax_actions_fro\156\164\145nd"),016); add_action("\167\160\137ajax_nopriv_\155\141\160smarker_aj\141\170\137actions_f\162\157\156tend",array( &$this,"\154\155\155_ajax_actions_\146\162\157ntend"),017); add_action("\141\144\155in_bar_menu",array( &$this,"\154mm_add_admin_b\141\162\137menu"),0225); if (!empty($O4)) { add_shortcode($O4["shortcode"],array( &$this,"\154\155m_showmap")); } add_filter("widget_text","\144o_shortcode"); if ( isset ($O4["misc_global_admin\137\156\157tices"]) && ($O4["misc_global_admi\156\137\156otices"] == "show")) { add_action("\141dmin_notices",array( &$this,"\154mm_compatibi\154\151\164y_checks")); } if (!empty($O4)) { if ($O4["misc_add_ge\157\162\163s_to_head"] == "enable\144") { add_action("wp_head",array( &$this,"\154mm_add_georss_to_he\141\144")); } } if ( isset ($O4["mi\163\143\137tinymce_butt\157\156"]) && ($O4["\155\151sc_tinymce_bu\164\164\157n"] == "enabled")) { require_once (plugin_dir_path( __FILE__)."\151\156\143".DIRECTORY_SEPARATOR."tinymce-plugi\156\056\160hp"); } if ( isset ($O4["misc\137\160\154ugin_language"]) && ($O4["m\151\163\143_plugin_langua\147\145"] != "automatic")) { add_filter("plugin_local\145",array( &$this,"\154mm_set_plugin_loca\154\145"),"lmm"); } add_action("\167\151dgets_init",create_function("","ret\165\162\156 register_widg\145\164\050\042C\154\141\163s_leaflet\137\162\145cent_mark\145\162\137widget\042\051\073")); if ( isset ($O4["\155isc_admin_d\141\163\150board_widget"]) && ($O4["\155\151\163c_admin_dashb\157\141\162d_widget"] == "ena\142\154\145d")) { if (!is_multisite()) { add_action("\167p_dashboard_se\164\165\160",array( &$this,"lmm_registe\162\137\167idgets")); } else { add_action("\167\160_network_das\150\142\157ard_setup",array( &$this,"lm\155\137\162egister_widget\163")); add_action("wp_dashboa\162\144\137setup",array( &$this,"\154mm_register_widge\164\163")); } } if (( isset ($O4["\155\151\163c_pointers"])) && ($O4["\155isc_pointers"] == "enabled")) { $version_before_update=get_option("leafle\164\155\141psmarker_ver\163\151\157n_pro_befor\145\137\165pdate"); if ($version_before_update != "\060") { add_action("\141dmin_enqueue_\163\143\162ipts",array($this,"lmm_update_point\145\162\137admin_script\163"),01751); } } add_action("a\144\155\151n_enqueue_scri\160\164\163",array($this,"\154\155\155_feature_poin\164\145\162_admin_scrip\164\163"),01752); if (is_multisite()) { add_action("\144\145lete_blog",array( &$this,"lmm_delete_multis\151te_blog")); } add_action("template_i\156\143lude",array( &$this,"\154\155m_template_ch\145\143\153_shortcode")); add_action("plugin_row_meta",array( &$this,"lmm_p\154\165\147ins_page_add_\154\151nks"),012,2); add_filter("upload_mim\145\163",array( &$this,"\154\155m_permit_mime_ty\160\145\163_on_upload")); add_filter("\160\157\163t_mime_type\163",array( &$this,"\154\155m_modify_post_\155\151\155e_types")); if (( isset ($O4["xml_sitema\160\163\137status"])) && ($O4["\170ml_sitemaps_sta\164\165\163"] == "\145nabled")) { add_action("sm_buildma\160",array( &$this,"lmm_\141\144\144_kml_to_site\155\141\160")); } } function lmm_deregister_scripts() { global $l5; if ( isset ($l5->O5) && is_array($l5->O5)) { foreach ($l5->O5 as $l6) { if (strpos($l6->O6 ,"maps.google.com\057\155aps/api/js") !== FALSE) { wp_dequeue_script($l6->l7); } } } } function lmm_ajax_actions_backend() { include ("inc".DIRECTORY_SEPARATOR."ajax-actions-bac\153\145nd.php"); } function lmm_ajax_actions_frontend() { include ("\151\156c".DIRECTORY_SEPARATOR."a\152\141\170-actions-front\145\156\144.php"); } function lmm_register_activation_hook() { global $wp_version; if (version_compare($wp_version,"\063\0563","\074")) { exit ("\133Maps Marke\162\040\120ro - instal\154\141\164ion failed!]\072\040WordPress Ve\162\163\151\157n 3.3 or h\151\147\150er is n\145\145ded for t\150\151\163 plugin \050\171ou are usi\156\147\040versi\157\156\040".$wp_version.") - \160\154\145ase upgrade yo\165\162\040WordPress\040\151\156stallati\157\156\041"); } if (version_compare(phpversion(),"\065.2","<")) { exit ("[Maps Marke\162\040\120ro - instal\154\141\164ion failed]\072\040PHP 5.2 is ne\145\144\145d for th\151\163\040plugin \050\171ou are usi\156\147 PHP ".phpversion()."; note: support f\157\162\040PHP 4 has \142\145\145n officiall\171\040\144iscontin\165\145\144 since 20\060\067-12-31!) - \160\154\145ase up\147\162\141de your\040\120\110P inst\141\154\154ation!"); } } function lmm_modify_post_mime_types($post_mime_types) { $post_mime_types["text/gpx"]=array(__("\107PX track","\154\155m"),__("\115\141\156age GPX tra\143\153\163","\154mm"),_n_noop("\107\120X track <span\040\143\154ass=\042\143\157\165nt\042>\050\045s)</span>","\107PX tracks <span cl\141\163\163=\042coun\164\042\076(%s)</sp\141\156\076","\154\155\155")); return $post_mime_types; } function lmm_permit_mime_types_on_upload($existing_mimes=array()) { $existing_mimes["gpx"]="\164ext/gpx"; return $existing_mimes; } function lmm_plugins_page_add_links($links,$file) { $plugin="\154eaflet-maps-ma\162\153\145r-pro/leafle\164\055maps-marker.ph\160"; $O7=get_option("leafletmapsmarker\137\166\145rsion_pro"); if ($file == $plugin) { $l8="\074a style=\042\164\145xt-decoratio\156\072\156one;\042\040\164\151tle=\042".esc_attr__("MapsMar\153\145\162 affiliate p\162\157\147ram - sign \165\160\040now and\040\162\145ceive co\155\155\151ssions \165\160\040to 50%\041","lmm")."\042 hr\145\146\075\042https\072\057/www.mapsmarker\056\143\157m/affilia\164\145\163\042 t\141\162\147et=\042\137\142\154ank\042\076\074img src=\042".O1."inc/img/ico\156\055\141ffiliates.p\156\147\042 width=\042\061\066\042 hei\147\150\164=\04216\042\040\141lt=\042".esc_attr__("\115apsMarker affil\151\141\164e program -\040\163\151gn up now\040\141nd receive co\155\155\151ssions \165\160\040to 50%!","\154mm")."\042></a>"; $O8="<\141\040\163tyle=\042\164\145\170t-decoration\072\156\157ne;\042\040\164\151tle=\042".esc_attr__("\115apsMarker resell\145\162\040program - \162\145\055sell with \141\04020% discount\041","\154\155\155")."\042 href=\042\150\164tps://www.m\141\160\163marker.com/re\163\145\154ler\042 \164\141\162get=\042\137\142lank\042>\074\151\155g src=\042".O1."\151\156c/img/icon-resel\154\145\162s.png\042\040\167idth=\04216\042\040\150eight=\042\061\066\042 al\164\075\042".esc_attr__("\115\141psMarker reselle\162\040\160rogram - r\145\055\163ell with \141\040\0620% disc\157\165\156t!","lmm")."\042></a>"; $l9="\074a style=\042\164\145xt-decoration\072\156\157ne;\042 \150\162\145f=\042h\164\164\160s://www.m\141\160\163marker.\143\157\155/revie\167\163\042 targ\145\164\075\042_\142\154\141nk\042\040\164itle=\042".esc_attr__("please rat\145\040\164his plugin \157\156\040wordpress.\157\162\147","\154\155m")."\042><img\040\163\162c=\042".O1."inc/img/icon-st\141\162\056png\042\040\167\151dth=\0421\066\042 height=\042\061\066\042 alt=\042".esc_attr__("please rate t\150\151\163 plugin on w\157\162\144press.org","\154\155m")."\042></a>"; $O9="<a href=\042\150\164tps://translate\056\155\141psmarker.co\155\057projects/lmm\042\040target=\042\137\142\154ank\042\040\164itle=\042".esc_attr__("translations","\154\155m")."\042><img src\075\042".O1."inc/img/\151\143\157n-translation\163\056\160ng\042 \167\151\144th=\042\061\066\042 heigh\164\075\04216\042 \141\154\164=\042".esc_attr__("\164ranslations","\154mm")."\042></a>"; $la="\074\141\040href=\042\150\164tps://facebook\056\143\157m/mapsmar\153\145\162\042 ta\162\147\145t=\042\137\142\154ank\042\040\164itle=\042".esc_attr__("\106\157\154low MapsMarke\162\040\157n Facebook","lmm")."\042><img sr\143\075\042".O1."inc/img/\151\143\157n-facebook.pn\147\042\040width=\042\061\066\042 heig\150\164\075\04216\042\040\141lt=\042".esc_attr__("\106\157\154low MapsMar\153\145\162 on Facebo\157\153","\154mm")."\042\076\074/a>"; $Oa="<a href=\042ht\164\160\163://twitter.com\057\155\141psmarker\042\040target=\042\137\142\154ank\042\040\164\151tle=\042".esc_attr__("\106ollow @Map\163\115\141rker on Twit\164\145\162","lmm")."\042><img src\075\042".O1."inc/img/icon-twi\164\164\145r.png\042\040\167\151dth=\042\061\066\042 height\075\042\0616\042\040\141\154t=\042".esc_attr__("\106\157llow @MapsMarke\162\040\157n Twitter","lmm")."\042></a>"; $lb="\074\141 href=\042ht\164\160\163://www.maps\155\141\162ker.com/+\042\040\164arget=\042\137\142lank\042 \164\151\164le=\042".esc_attr__("\106ollow MapsMar\153\145\162 on Google+","lmm")."\042><img src\075\042".O1."inc/img/icon-goo\147\154\145-plus.png\042\040\167idth=\04216\042\040height=\042\061\066\042 alt=\042".esc_attr__("\106\157llow MapsMarker \157\156\040Google+","lmm")."\042></a>"; $Ob="\074a href=\042\150\164tps://feeds.fe\145\144\142urner.com/\115\141\160sMarker\042\040\164arget=\042\137\142lank\042\040\164itle=\042\122\123\123\042>\074\151mg src=\042".O1."\151nc/img/icon-rss\056\160\156g\042 wi\144\164\150=\04216\042\040height=\042\061\066\042 alt=\042\162\163s\042></\141\076"; $lc="<a href=\042h\164\164\160://feedburner\056\147\157ogle.com/f\142\057\141/mailveri\146\171\077uri=Maps\115\141\162ker\042\040\164arget=\042\137\142lank\042 \164\151\164le=\042\122\123S (via Ema\151\154\051\042>\074\151mg src=\042".O1."inc/img/icon-rss\055\145\155ail.png\042\040\167idth=\0421\066\042\040height=\042\0616\042 alt=\042\162\163s-email\042\076\074/a>"; if ((Oc($ld=FALSE,$Od=TRUE) === TRUE) && (Oc() === FALSE)) { $le="<br/></td></tr><\164\162\076<td colsp\141\156\075\0423\042\040\163tyle=\042\142\157\162der-botto\155\072\061px sol\151\144\040#ccc;p\141\144\144ing:0;\042\076<div style\075\042padding: 3\160\170\0405px;ba\143\153ground-colo\162\072 #FFEBE8;\142\157\162der: 1\160\170\040solid\040\043CC0000;co\154\157\162: #33\063\073\042><s\164\162\157ng>".__("War\156\151\156g: your access\040\164\157 updates a\156\144\040support \146\157\162 Maps Mark\145\162\040Pro has\040\145\170pired!","\154\155m")."\074/strong><br/>"; $Oe=get_option("leafl\145\164\155apsmarker_ve\162\163\151on_pro_late\163\164"); if (($Oe != NULL) && ($Oe>$O7)) { $le.=__("Latest\040\141\166ailable vers\151\157\156:","lmm")." <a href='http\163\072\057/www.maps\155\141\162ker.com/v".$Oe."p' target='_\142\154\141nk' title='".esc_attr__("\143\154ick to show releas\145\040\156otes","lmm")."'>".$Oe."</a> "."(<a href='www.\155\141\160smarker.com\057\143\150angelog/pr\157\057\047 target=\047\137\142lank'>".__("show al\154\040\141vailable chan\147\145\154ogs","lmm")."</a>)<br/>"; } $le.=sprintf(__("You can continue \165\163\151ng version \045\163\040without \141\156\171 limitati\157\156\163. Neverth\145\154\145ss you \167\151\154l not \142\145\040able t\157\040get updates\040\151ncluding b\165\147\146ixes, \156\145\167 featur\145\163\040and op\164\151mizations\040\141s well as \141\143\143ess to\040\157ur suppor\164\040system. ","l\155\155"),$O7)."<br/>".sprintf(__("<a href=\042\045\163\042>Pleas\145\040\162enew your \141\143\143ess to up\144\141\164es and su\160\160\157rt to ke\145\160\040your \160\154\165gin up-\164\157\055date a\156\144\040safe<\057\141\076.","\154\155\155"),l1."\141\144min.php?page=l\145\141\146letmapsmar\153\145\162_license")."</div>"; } else { $le=""; } $links[]=$l8."\046nbsp;".$O8."&nbsp;".$l9."\046nbsp;".$O9."&nbsp;".$la."\046nbsp;".$Oa."&nbsp;".$lb."\046nbsp;".$Ob."\046\156bsp;".$lc.$le; } return $links; } function lmm_delete_multisite_blog($blog_id) { switch_to_blog($blog_id); $GLOBALS["wpdb"]->query("\104ROP TABLE `".$GLOBALS["\167pdb"]->prefix."\154eafletmapsmarker\137\154\141yers`"); $GLOBALS["wpdb"]->query("DROP TABLE `".$GLOBALS["wpdb"]->prefix."leafletmapsmark\145\162\137markers`"); $O0=wp_upload_dir(); $icons_directory=$O0["\142asedir"].DIRECTORY_SEPARATOR."\154eaflet-maps-mark\145\162\055icons".DIRECTORY_SEPARATOR; if (is_dir($icons_directory)) { foreach (glob($icons_directory."*.*") as $v) { unlink($v); } rmdir($icons_directory); } } function lmm_update_pointer_admin_scripts() { $dismissed_pointers=explode("\054",( string) get_user_meta(get_current_user_id(),"\144\151smissed_wp_point\145\162\163",TRUE)); $dismissed_pointers=array_flip($dismissed_pointers); $lf=FALSE; $lmm_version_new=get_option("le\141\146\154etmapsmarker_v\145\162\163ion_pro"); $Of="\154\155mvp".str_replace("\056","",$lmm_version_new); if (! isset ($dismissed_pointers[$Of])) { $current_dismissed_wp_pointers=get_user_meta(get_current_user_id(),"d\151\163\155issed_wp_poin\164\145\162s"); $replace_lmmv=preg_replace("/(lmmv(p)?(\134\144\051\053(,)?)/",NULL,$current_dismissed_wp_pointers["\060"]); $replace_without_end_coma=preg_replace("\057(,)\044\057",NULL,$replace_lmmv); update_user_meta(get_current_user_id(),"\144\151\163missed_wp_po\151\156\164ers",$replace_without_end_coma); $lf=TRUE; add_action("\141\144min_print_f\157\157\164er_scripts",array($this,"\154\155\155_update_point\145\162\137footer_scrip\164")); } if ($lf) { wp_enqueue_script("wp-pointer"); wp_enqueue_style("\167\160-pointer"); } } function lmm_update_pointer_footer_script() { $O4=get_option("\154eafletmapsma\162\153\145r_options"); $lmm_version_new=get_option("\154eafletmapsmarker\137\166\145rsion_pro"); $Of="lmmvp".str_replace(".","",$lmm_version_new); $lg="<h3>".sprintf(esc_attr__("\115aps Marker Pro\040\160\154ugin update\040\164\157 v%1s was\040\163\165ccessful","\154mm"),$lmm_version_new)."<\057\150\063>"; if (get_option("\154eafletmapsma\162\153\145r_update_info") == "s\150\157\167") { $changelog_url="\074\141 href=\042".l1."\141dmin.php?page=lea\146\154\145tmapsmarker_m\141\162\153ers"."\042\040\163tyle=\042\164\145\170t-decoratio\156\072\156one;\042\076".__("changelog","\154\155m")."\074\057a>"; } else { $changelog_url="\074a href=\042\150\164\164ps://www.\155\141\160smarker.co\155\057v".$lmm_version_new."p\042 \163\164\171le=\042te\170\164\055decoration:\156\157\156e;\042 \164\141\162get=\042\137\142\154ank\042\076".__("\143\150angelog","\154\155m")."</a>"; } $blogpost_url="<a href=\042h\164\164\160s://www.mapsm\141\162\153er.com/v".$lmm_version_new."p\042\040\164\141rget=\042\137\142\154ank\042 \163\164\171le=\042t\145\170\164-decorati\157\156\072none;\042\076\155apsmarker\056\143om</a>"; $lg.="\074\160>".sprintf(esc_attr__("Please see th\145\040\0451s for new\040\146\145atures or \164\150\145 blog pos\164\040\157n %2s fo\162\040\155ore det\141\151\154s","lmm"),$changelog_url,$blogpost_url)."\074\057p>"; ?><?php echo "\015\012\011\011\074\163\143ript type=\042\164\145xt/javas\143\162\151pt\042>/\057\040<![CDATA[\015\012\011\011jQ\165\145ry(documen\164\051.ready(fun\143\164\151on(\044\051\040\173\015\012\011\011\011\151\146(typeof(jQ\165\145\162y().po\151\156\164er) !=\040\047undefine\144\047) \173\015\012\011\011\011\011\044('#tople\166\145l_page_le\141\146\154etmap\163\155arker_mar\153\145rs').poin\164\145r(\173\015\012\011\011\011\011\011conte\156\164: '"; ?><?php echo $lg; ?><?php echo "\047,\015\012\011\011\011\011\011\160\157sition: \173\015\012\011\011\011\011\011\011\145\144\147e: 'lef\164\047\054\015\012\011\011\011\011\011\011align: \047\143enter'\015\012\011\011\011\011\011},\015\012\011\011\011\011\011\143lose: fun\143\164\151on() \173\015\012\011\011\011\011\011\011\044.post( aj\141\170\165rl, \173\015\012\011\011\011\011\011\011\011\160ointe\162\072 '"; ?><?php echo $Of; ?><?php echo "\047\054\015\012\011\011\011\011\011\011\011action: \047\144\151smiss-wp\055\160ointer'\015\012\011\011\011\011\011\011});\015\012\011\011\011\011\011}\015\012\011\011\011\011\175\051.point\145\162\050'open'\051\073\015\012\011\011\011}\015\012\011\011});\015\012\011\011\057\057 ]]></sc\162\151pt>\015\012\011\011"; ?><?php } function lmm_feature_pointer_admin_scripts() { $dismissed_pointers=explode("\054",( string) get_user_meta(get_current_user_id(),"dismis\163\145\144_wp_pointers",TRUE)); $dismissed_pointers=array_flip($dismissed_pointers); $lf=FALSE; if (! isset ($dismissed_pointers["\154\155mesw"])) { $lf=TRUE; add_action("\141dmin_print_foo\164\145\162_scripts",array($this,"lmm_fe\141\164\165re_pointer_fo\157\164\145r_script")); } if ($lf) { wp_enqueue_script("wp-poin\164\145\162"); wp_enqueue_style("\167\160-pointer"); } } function lmm_feature_pointer_footer_script() { include ("inc".DIRECTORY_SEPARATOR."\146\145ature-pointers\056\160\150p"); } function lmm_register_widgets() { $O4=get_option("\154eafletmapsma\162\153\145r_options"); if ($O4["misc_whitelabel\137\142\141ckend"] == "\145\156abled") { $Og=__("\115aps - recent m\141\162\153ers","lmm"); } else { $Og=__("Maps Marker\040\120\162o - recent\040\155\141rkers","lmm"); } wp_add_dashboard_widget("lmm\055\141\144min-dashboard\055\167\151dget",$Og,array( &$this,"lmm_dash\142\157\141rd_widget"),array( &$this,"\154mm_dashboard_w\151\144\147et_control")); } function lmm_dashboard_widget() { global $wpdb; $O4=get_option("leafle\164\155apsmarker_op\164\151ons"); if ($O4["\144efaults_mar\153\145\162_custom_ico\156\137\165rl_dir"] == "no") { $defaults_marker_icon_dir=l3; $defaults_marker_icon_url=O2; } else { $defaults_marker_icon_dir=htmlspecialchars($O4["\144\145faults_marker\137\151\143on_dir"]); $defaults_marker_icon_url=htmlspecialchars($O4["\144efaults_marker_\151\143\157n_url"]); } $table_name_markers=$wpdb->prefix."leafletmapsmarker_m\141\162\153ers"; $widgets=get_option("\144\141shboard_widget_\157\160\164ions"); $widget_id="\154mm-admin-dashbo\141\162\144-widget"; $number_of_markers= isset ($widgets[$widget_id]) && isset ($widgets[$widget_id]["\151\164ems"]) ? absint($widgets[$widget_id]["\151tems"]): 4; if ((Oc($ld=FALSE,$Od=TRUE) === TRUE) && (Oc() === FALSE)) { $O7=get_option("\154eafletmapsm\141\162\153er_version_pr\157"); echo "\074\144iv style=\042\160\141\144ding: 3px \065\160\170;backgroun\144\055\143olor: #F\106\105\102E8;border\072\0401px solid #\103\103\060000;b\157\162\144er-radi\165\163\072 3px;c\157\154\157r: #333\073\042><strong>".__("Warning: your acc\145\163\163 to updates \141\156\144 support fo\162\040\115aps Mar\153\145\162 Pro has\040\145\170pired!","\154mm")."\074/strong><br/\076"; $Oe=get_option("leafle\164\155\141psmarker_vers\151\157\156_pro_latest"); if (($Oe != NULL) && ($Oe>$O7)) { echo __("Latest availa\142\154\145 version:","lmm")." <a href\075\047https://www.mapsm\141\162\153er.com/v".$Oe."p' target='_\142\154\141nk' title='".esc_attr__("\143\154\151ck to show r\145\154\145ase notes","lmm")."'>".$Oe."\074/a> "."(<\141\040\150ref='https://w\167\167\056mapsmarker.\143\157\155/changelog\057\160\162o/' targ\145\164\075'_blank\047\076".__("\163how all availab\154\145\040changelog\163","\154\155m")."\074/a>)<br/>"; } echo sprintf(__("\131ou can continue\040\165\163ing version\040\045s without any\040\154\151mitation\163\056\040Nevert\150\145\154ess you \167\151\154l no\164\040be able to\040\147\145t upda\164\145\163 includ\151\156\147 bugfi\170\145\163, new \146\145\141tures \141\156\144 optim\151\172\141tions \141\163\040well \141\163\040access\040\164o our su\160\160\157rt sy\163\164\145m. ","l\155\155"),$O7)."\074br/>".sprintf(__("<a href=\042%s\042\076Please renew you\162\040\141ccess to up\144\141\164es and s\165\160\160ort to k\145\145\160 your pl\165\147\151n up-to\055\144ate and sa\146\145\074/a>.","\154mm"),l1."admin.php?p\141\147\145=leafletmapsm\141\162\153er_license")."</div>"; echo "\074hr style=\042\142\157rder:0;height:1\160\170\073background\055\143\157lor:#d8d\070\144\070;\042/\076"; } $lh=$wpdb->get_results($wpdb->prepare( "SELE\103\124\040`id`,`marker\156\141\155e`,`icon`,`\143\162\145atedon`,`\143\162\145atedby` F\122\117\115 `$table_name_markers` ORDE\122\040\102Y `createdon`\040\144\145sc LIMIT %d" ,$number_of_markers),ARRAY_A); if ($lh != NULL) { echo "<table style=\042\155\141rgin-bottom\072\065\160x;\042>\074\164\162>"; foreach ($lh as $row) { $icon=($row["ic\157\156"] == NULL) ? O1."leaflet-di\163\164\057images/mark\145\162\056png": $defaults_marker_icon_url."/".$row["icon"]; echo "<\164\144\076<a href=\042".l1."admin.php?pa\147\145\075leafletmaps\155\141\162ker_marker\046\151\144=".$row["i\144"]."\042\040title=\042".esc_attr__("\145\144it marker","\154\155m")."\042><img src=\042".$icon."\042\040width=\042".intval($O4["d\145\146\141ults_marker_ic\157\156\137iconsize_\170"])."\042 height=\042".intval($O4["defaults_ma\162\153\145r_icon_iconsi\172\145\137y"])."\042>\074\057\141>"; echo "<td style=\042\166\145\162tical-alig\156\072\164op;line-hei\147\150\164:1.2em;\042\076"; echo "<a href=\042".l1."admin.php?page\075\154\145afletmaps\155\141\162ker_marker&\151\144\075".$row["id"]."\042\040\164\151tle=\042".esc_attr__("\145\144\151t marker","\154mm")."\042\076".htmlspecialchars(stripslashes($row["markername"]))."\074\057a><br/>".__("\143\162eated on","lmm")." ".date("Y-m-\144\040\055 h:m",strtotime($row["\143reatedon"]))."\054\040".__("\143\162\145ated by","\154\155m")." ".$row["\143\162eatedby"]; echo "\074\057td></tr>"; } echo "\074/table>"; } else { echo "\074p style=\042m\141\162\147in-bottom:5\160\170\073\042>".__("\116\157 marker create\144\040\171et","\154mm")."\074/p>"; } if (! isset ($widgets[$widget_id]["\142logposts"])) { $Oh=1; } else if ( isset ($widgets[$widget_id]["\142logposts"]) && ($widgets[$widget_id]["\142logposts"] == 1)) { $Oh=0; } else { $Oh=1; } function lmm_spc_custom_name($Oi) { return "mapsmar\153\145\162-dashboard-w\151\144\147et-rss-ite\155\055\143ache"; } if (($Oh == 1) && ($O4["misc_whitela\142\145\154_backend"] == "disable\144")) { require_once (ABSPATH.WPINC.DIRECTORY_SEPARATOR."class-simplepie.\160\150\160"); $lj=new simplepie(); if (file_exists($defaults_marker_icon_dir.DIRECTORY_SEPARATOR."readme-ic\157\156\163.txt")) { $lj->enable_cache(TRUE); $lj->set_cache_location($location=$defaults_marker_icon_dir); $lj->set_cache_name_function("\154\155\155_spc_custom_n\141\155\145"); $lj->set_cache_duration(0250600); } else { $lj->enable_cache(FALSE); } $lj->set_feed_url("htt\160\072\057/feeds.feed\142\165\162ner.com/Maps\115\141\162kerPro"); $lj->set_stupidly_fast(TRUE); $lj->enable_order_by_date(TRUE); $lj->init(); $lj->handle_content_type(); echo "<hr s\164\171\154e=\042\142\157rder:0;height\072\061px;backgroun\144\055\143olor:#d8\144\070\1448;\042\057\076<p style=\042\155\141rgin:0\056\065em 0px;fo\156\164\055weight\072\142\157ld;\042\076".__("\114\141test blog pos\164\163\040from www.m\141\160\163marker.com","\154\155m")."\074/p>"; if ($lj->get_items() == NULL) { $blogpost_url="<a href=\042\150\164\164ps://www.m\141\160\163marker.com\057\156\145ws\042\040\164\141rget=\042\137\142lank\042>\150\164\164ps://ww\167\056mapsmarker\056\143om/news</a\076"; echo sprintf(__("Feed could not \142\145\040retrieved\054\040please try aga\151\156 later or rea\144\040\164he lates\164\040blog posts \141\164\040%s","\154\155m"),$blogpost_url); } foreach ($lj->get_items(0,3) as $item) { echo "<p s\164\171\154e=\042mar\147\151\156:0.5em 0;\042\076".$item->get_date("j F Y").": <a \150\162\145f=\042".$item->get_permalink()."\077\162ef=dashboard\042\076".str_replace("\144\151v>","\163\160an>",$item->get_title())."</\141\076\074/p>".PHP_EOL; } echo "<hr s\164\171le=\042borde\162\072\060;height:1\160\170\073backgroun\144\055\143olor:#d8\144\070\1448;\042\057\076\012\011\011\011\011<div st\171\154e=\042dis\160\154\141y:inlin\145\055block;\042\076\074a style=\042\164ext-decora\164\151\157n:none\073\042 href=\042\150ttps://w\167\167\056mapsm\141\162\153er.com\042\040target=\042\137\142lank\042\076\074img sr\143\075\042".O1."\151\156\143/img/icon-webs\151\164\145-home.png\042\040\167idth=\042\061\066\042 height\075\04216\042 alt\075\042\155apsmar\153\145\162.com\042\076\040MapsMar\153\145\162.com</a\076\074/div>&nbsp\073\012\011\011\011\011\074div styl\145\075\042displ\141\171\072inlin\145\055block;\042\076\074a style=\042\164\145xt-de\143\157\162ation:\156\157ne;\042 t\151\164le=\042".esc_attr__("\115\141\160sMarker aff\151\154\151ate program \055\040\163ign up n\157\167\040and recei\166\145\040commiss\151\157\156s up to\040\0650%!","\154mm")."\042\040\150\162ef=\042htt\160\163\072//www.maps\155\141\162ker.com/af\146\151\154iates\042\040\164arget=\042_\142\154ank\042><i\155\147\040src=\042".O1."inc/img/ico\156\055\141ffiliates\056\160\156g\042 wid\164\150\075\04216\042\040\150eight=\042\061\066\042 alt=\042".esc_attr__("\115\141\160sMarker affil\151\141\164e program -\040\163\151gn up now\040\141nd receive c\157\155\155issions u\160\040to 50%!","\154\155\155")."\042\076\040".__("\101\146\146iliates","lmm")."\074\057a></div>&nbsp\073\012\011\011\011\011\074\144iv style=\042\144\151splay:inli\156\145\055block;\042\076\074a styl\145\075\042text-d\145\143oration:no\156\145\073\042 \164\151\164le=\042".esc_attr__("MapsMarker\040\162\145seller prog\162\141\155 - re-sell\040\167\151th a 20% \144\151scount!","lmm")."\042 href=\042\150\164tps://www.m\141\160\163marker.com/\162\145\163eller\042\040\164arget=\042\137\142\154ank\042\076\074img src=\042".O1."inc/img/icon-rese\154\154\145rs.png\042\040\167\151dth=\042\061\066\042 heig\150\164\075\04216\042\040\141lt=\042".esc_attr__("MapsMarker r\145\163\145ller progra\155\040\055 re-sell \167\151\164h a 20% d\151\163\143ount!","\154mm")."\042\076\040".__("R\145\163\145llers","\154\155m")."</a></div>&nbsp\073\012\011\011\011\011\074div style=\042\144\151splay:inline\055\142\154ock;\042\076\074a style=\042\164\145xt-decora\164\151\157n:none\073\042 href=\042\150\164tps://www.\155\141\160smarker\056\143om/reviews\042\040\164arget=\042\137blank\042\040\164itle=\042".esc_attr__("please rate thi\163\040\160lugin on wo\162\144\160ress.org","\154\155\155")."\042><img\040\163\162c=\042".O1."\151nc/img/icon-\163\164\141r.png\042\040\167\151dth=\0421\066\042 height=\042\061\066\042 alt=\042".esc_attr__("\160lease rate th\151\163\040plugin on w\157\162\144press.org","\154\155\155")."\042> ".__("\162\141te plugin","\154\155m")."</a></div>&nbsp;\012\011\011\011\011\074\144\151v style=\042\144\151splay:inlin\145\055\142lock;\042\076\074a href=\042\150\164tps://tr\141\156\163late.m\141\160\163marker.\143\157\155/projec\164\163\057lmm\042\040\164arget=\042\137\142lank\042\076\074img src\075\042".O1."\151\156c/img/icon-\164\162\141nslations.pn\147\042\040width=\042\061\066\042 hei\147\150\164=\04216\042\040\141lt=\042\164\162\141nslati\157\156\163\042>\040".__("translations","\154\155m")."</a></d\151\166\076&nbsp;\012\011\011\011\011<div st\171\154\145=\042dis\160\154\141y:inline-\142\154\157ck;\042\076\074a href=\042\150\164tps://twit\164\145\162.com/ma\160\163marker\042\040\164arget=\042\137\142lank\042\076\074img src=\042".O1."inc/img/icon-\164\167\151tter.png\042\040\167idth=\0421\066\042 height=\042\061\066\042 alt=\042\164\167itter\042\076\040Twitter</\141\076\074/div>\046\156\142sp;\012\011\011\011\011<\144\151\166 style\075\042display:in\154\151\156e-bloc\153\073\042><a h\162\145\146=\042\150\164\164ps://f\141\143ebook.com/\155\141psmarker\042\040\164arget=\042\137blank\042\076\074img src=\042".O1."inc/img/icon-\146\141\143ebook.png\042\040\167idth=\0421\066\042 height=\042\061\066\042 alt=\042\146\141cebook\042\076\040Facebook\074\057a></div>&\156\142\163p;\012\011\011\011\011<d\151\166\040style=\042\144\151splay:\151\156\154ine-bl\157\143\153;\042\076\074a href=\042\150\164tps://w\167\167\056mapsm\141\162\153er.com\057\053\042 ta\162\147\145t=\042\137\142lank\042\076\074img src=\042".O1."in\143\057\151mg/icon-goog\154\145\055plus.png\042\040\167idth=\042\061\066\042 height\075\04216\042 alt\075\042google+\042\076\040Google+<\057\141></div>&nb\163\160\073\012\011\011\011\011<div\040\163\164yle=\042\144\151splay:in\154\151\156e-bloc\153\073\042><a s\164\171le=\042te\170\164-decorati\157\156\072none;\042\040href=\042\150\164tps://www\056\155apsmarker\056\143om/chang\145\154og/pro\042\040\164arget=\042\137blank\042\076\074img sr\143\075\042".O1."\151\156\143/img/icon-c\150\141\156gelog-head\145\162\056png\042\040\167\151dth=\042\061\066\042 hei\147\150\164=\0421\066\042 alt=\042\143\150angelog\042\076\040".__("\103\150angelog","\154\155m")."\074/a></div>&nb\163\160\073\012\011\011\011\011<div style\075\042display:inlin\145\055\142lock;\042\076\074a href=\042\150\164tps://fee\144\163\056feedb\165\162\156er.com/\115\141\160sMarker\042\040target=\042\137\142lank\042\076\074img src=\042".O1."\151nc/img/icon-\162\163\163.png\042 \167\151\144th=\0421\066\042\040height=\042\061\066\042 a\154\164\075\042r\163\163\042> RSS</\141\076</div>&nbs\160\073\012\011\011\011\011<div sty\154\145\075\042d\151\163\160lay:in\154\151\156e-bloc\153\073\042><a h\162\145\146=\042\150\164\164p://fe\145\144\142urner.\147\157\157gle.co\155\057fb/a/mail\166\145rify?uri=\115\141\160sMark\145\162\042 targ\145\164=\042_bl\141\156k\042><i\155\147 src=\042".O1."inc/img/i\143\157n-rss-email.png\042\040width=\04216\042\040\150eight=\042\061\066\042 alt\075\042\162ss-emai\154\042\076 ".__("E-Mai\154","lmm")."\074/a></div>"; } } function lmm_dashboard_widget_control() { $O4=get_option("lea\146\154\145tmapsmarker_op\164\151\157ns"); $widget_id="\154\155m-admin-dashbo\141\162\144-widget"; $form_id="\154mm-admin-dashboa\162\144\055widget-cont\162\157\154"; $update=FALSE; if (!$widget_options=get_option("dash\142\157\141rd_widget_opt\151\157\156s")) $widget_options=array(); if (! isset ($widget_options[$widget_id])) { $widget_options[$widget_id]=array("blogposts" => 0,"\151\164\145ms" => 5); $update=TRUE; } if ("POST" == $_SERVER["R\105\121\125EST_METHOD"] && isset ($_POST[$form_id])) { $number=($_POST[$form_id]["items"] == NULL) ? "3": absint($_POST[$form_id]["items"]); $Oj= isset ($_POST[$form_id]["\142\154ogposts"]) ? "\061": "0"; $widget_options[$widget_id]["\151\164ems"]=$number; $widget_options[$widget_id]["blogposts"]=$Oj; $update=TRUE; } if ($update) update_option("d\141\163\150board_widget_\157\160\164ions",$widget_options); $number= isset ($widget_options[$widget_id]["items"]) ? ( integer) $widget_options[$widget_id]["\151tems"]: ""; echo "\074\160><label for\075\042\154mm-admin-\144\141\163hboard-wid\147\145\164-number\042\076".__("Number of ma\162\153\145rs to show:")."\040</label>"; echo "\074\151nput id=\042lm\155\055\141dmin-dashbo\141\162\144-widget-nu\155\142\145r\042 na\155\145\075\042".$form_id."\133items]\042 ty\160\145\075\042text\042\040\166alue=\042".$number."\042 size\075\042\062\042 /\076\074\057p>"; if ($O4["\155isc_whitelabel_ba\143\153\145nd"] == "disabled") { echo "<p><label for=\042\154\155m-admin-dash\142\157\141rd-widget-b\154\157\147posts\042\076".__("Hide blog p\157\163\164s and link s\145\143\164ion:")."\040</label>"; echo "<input id\075\042lmm-admin-dashb\157\141\162d-widget-b\154\157\147posts\042\040\156ame=\042".$form_id."\133blogposts]\042\040\164\171pe=\042\143\150\145ckbox\042\040".checked($widget_options[$widget_id]["\142logposts"],1,FALSE)."/></p>"; } } function lmm_load_translation_files() { load_plugin_textdomain("lmm",FALSE,dirname(plugin_basename( __FILE__))."\057languages/"); } function lmm_set_plugin_locale($lang) { $O4=get_option("leafletmapsmarker_\157\160\164ions"); global $locale; if ($O4["misc\137\160\154ugin_langua\147\145\137area"] == "backend") { return is_admin() ? $O4["misc_plugin_langua\147\145"]: $locale; } else if ($O4["misc_plugin_languag\145\137\141rea"] == "frontend") { return is_admin() ? $locale: $O4["\155isc_plugin_lang\165\141\147e"]; } else if ($O4["\155isc_plugin_lang\165\141\147e_area"] == "both") { return $O4["misc_plugin_langu\141\147\145"]; } else { return $locale; } } function lmm_compatibility_checks() { include ("inc".DIRECTORY_SEPARATOR."compatibili\164\171\055checks.ph\160"); } function lmm_help() { include ("\154eaflet-help-c\162\145\144its.php"); } function lmm_settings() { global $lk; $lk->display_page(); } function lmm_list_layers() { include ("\154\145aflet-list-\154\141\171ers.php"); } function lmm_list_markers() { include ("\154\145aflet-list-\155\141\162kers.php"); } function lmm_layer() { include ("leaflet-laye\162\056\160hp"); } function lmm_marker() { include ("\154eaflet-marker.\160\150\160"); } function lmm_import_export() { include ("leaflet-import-ex\160\157\162t.php"); } function lmm_tools() { include ("leaflet-tool\163\056\160hp"); } function lmm_apis() { if (!current_user_can("\141\143tivate_plugins")) { return; } settings_errors(); require_once l2."inc/admin-head\145\162\056php"; require_once l2."inc/a\144\155\151n-header-apis.\160\150\160"; require_once l2."inc/class-\141\160\151-keys-tabl\145\056\160hp"; $Ok=new mmp_api_keys_table(); $Ok->prepare_items(); $Ok->display(); require_once l2."inc/\141\144\155in-footer.ph\160"; } function lmm_add_georss_to_head() { $georss_to_head="<link rel=\042\141\154ternate\042\040\164ype=\042ap\160\154\151cation/rss\053\170ml\042 titl\145\075\042".get_bloginfo("nam\145")."\040\107eoRSS-Feed\042\040\150ref=\042".O1."\154eaflet-georss.php?\154\141\171er=all\042\040\057>".PHP_EOL; echo $georss_to_head; } function lmm_showmap($atts) { require ("\151nc".DIRECTORY_SEPARATOR."\163\150owmap_prepare.php"); $ll=apply_filters("\155\155\160_map_content",$ll,$atts); return $ll; } function lmm_load_settings_class() { if (is_admin()) { require_once (plugin_dir_path( __FILE__)."in\143".DIRECTORY_SEPARATOR."\143lass-leaflet-\157\160\164ions.php"); global $lk; $lk=new class_leaflet_options(); } } function lmm_admin_menu() { global $wp_version; if (version_compare($wp_version,"3.8-alpha","\076")) { $lm="-white"; } else { $lm=""; } $O4=get_option("le\141\146\154etmapsmarker_\157\160\164ions"); if (!empty($O4)) { $capabilities=$O4["capabilities_v\151\145\167_others"]; $Om="activate_plugins"; $ln=$O4["\143apabilities_edit_ot\150\145\162s"]; } else { $capabilities="\145dit_posts"; $Om="\141\143tivate_plugi\156\163"; $ln="\141\143\164ivate_plugins"; } if (!empty($O4)) { if ($O4["\155isc_whitela\142\145\154_backend"] == "enabled") { $On=esc_attr__("\115\141\160s","\154\155m"); $Om="activate_\160\154\165gins"; $ln=$O4["capabilitie\163\137\145dit_others"]; } else { $On="\074\163\160an style=\042\146\157nt-size:92%;\042\076Maps Marker \120\162\157</span>"; $Om=$O4["cap\141\142\151lities_view_ot\150\145\162s"]; $ln=$O4["\143apabilities_e\144\151\164_others"]; } } else { $On="\115aps Marker Pro"; $Om="\141ctivate_plug\151\156\163"; $ln="\141\143tiv\141te_plug\151\156\163"; } $page=add_menu_page($On,$On,$capabilities,"le\141\146\154etmapsmarker_\155\141\162kers",array( &$this,"lm\155\137\154ist_markers"),O1."\151\156c/img/icon-men\165\055\160age".$lm."\056\160\156g","\0625.071"); if (!empty($O4)) { $page2=add_submenu_page("\154\145\141fletmapsmark\145\162\137markers",$On."\040\055 ".__("\114\151st all markers","\154mm"),"\074\151mg src=\042".O1."\151\156c/img/icon-men\165\055\154ist".$lm."\056\160\156g\042> ".__("List all markers","\154mm"),$O4["\143apabilities_view\137\157\164hers"],"\154\145afletmapsmarke\162\137\155arkers",array( &$this,"lmm_\154\151\163t_markers")); $page3=add_submenu_page("\154\145\141fletmapsmark\145\162\137markers",$On."\040\055 ".__("a\144\144\057edit marker","lmm"),"\074\151mg src=\042".O1."\151\156c/img/icon-menu-\141\144\144".$lm.".png\042\076\040".__("\101\144\144 new marker","lmm"),$O4["\143\141pabilities_v\151\145\167_others"],"leafletmapsmarke\162\137\155arker",array( &$this,"l\155\155\137marker")); $page3b=add_submenu_page("\154\145afletmapsmarker_\155\141\162kers",$On." - ".__("I\155\160\157rt/Export","lmm"),"\074\151mg src=\042".O1."\151\156c/img/icon-menu\055\151\155port-export".$lm."\056png\042> ".__("\111\155port/Export","\154mm"),$O4["ca\160\141\142ilities_view_oth\145\162\163"],"\154\145afletmapsmarker_\151\155\160ort_export",array( &$this,"lm\155\137\151mport_export")); $page4=add_submenu_page("\154eafletmapsma\162\153\145r_markers",$On." - ".__("\114\151\163t all layers","lmm"),"\074img src=\042".O1."\151\156\143/img/icon-men\165\055\154ist".$lm.".png\042\076\040".__("List \141\154\154 layers","\154mm"),$O4["\143apabilities_vie\167\137\157thers"],"\154\145\141fletmapsmarker_\154\141\171ers",array( &$this,"lmm_l\151\163\164_layers")); $page5=add_submenu_page("\154\145afletmapsma\162\153\145r_markers",$On."\040\055\040".__("add/edi\164\040\154ayer","\154\155m"),"\074img src=\042".O1."\151\156\143/img/icon-menu\055\141\144d".$lm.".png\042\076\040".__("\101\144\144 new layer","\154mm"),$O4["\143\141pabilities_vie\167\137\157thers"],"\154\145afletmapsmark\145\162\137layer",array( &$this,"lmm_laye\162")); } else { $page=""; $page2=""; $page3=""; $page3b=""; $page4=""; $page5=""; } $page6=add_submenu_page("leaf\154\145\164mapsmarker_m\141\162\153ers",$On."\040\055 ".__("Tools","lmm"),"<hr noshade size=\042\061\042/><img sr\143\075\042".O1."\151nc/img/icon-me\156\165\055tools".$lm."\056\160ng\042> ".__("\124ools","\154\155\155"),$ln,"leafletmapsmarke\162\137\164ools",array( &$this,"lmm_t\157\157\154s")); $page7=add_submenu_page("leafle\164\155\141psmarker_mark\145\162\163",$On." - ".__("Se\164\164\151ngs","\154mm"),"\074img src=\042".O1."\151\156\143/img/icon-menu-s\145\164\164ings".$lm."\056\160\156g\042> ".__("Settings","lm\155"),$Om,"le\141\146\154etmapsmarker_se\164\164\151ngs",array( &$this,"lmm_settings")); $page11=add_submenu_page("\154eafletmapsmarker\137\155\141rkers",$On." -\040".__("Maps Marker APIs","lmm"),"\074img src=\042".O1."\151\156c/img/icon-menu-a\160\151".$lm."\056png\042\076\040".__("Maps Marker\040\101\120Is","\154mm"),$Om,"\154eafletmapsma\162\153\145r_apis",array( &$this,"\154mm_apis")); if (!empty($O4)) { $page8=add_submenu_page("\154\145afletmapsm\141\162\153er_markers",$On."\040\055 ".__("\123\165\160port","\154\155m"),"\074\151mg src=\042".O1."\151\156c/img/icon-me\156\165\055help".$lm."\056\160ng\042> ".__("\123\165pport","\154mm"),$Om,"leafletmapsmarke\162\137\150elp",array( &$this,"l\155\155\137help")); $page10=add_submenu_page("\154eafletmapsmarker_m\141\162\153ers",$On." - ".__("License settings","\154mm"),"\074hr noshade size=\042\061\042/><img src\075\042".O1."\151\156\143/img/icon-menu-\163\145\164tings".$lm."\056png\042> ".__("Lic\145\156\163e settings","\154\155m"),$Om,"\154\145afletmapsmarker_\154\151\143ense","maps_marker_pro_l\151\143\145nse_activat\151\157\156_page"); } else { $page8=""; $page10=""; } add_action("admin_print_scri\160\164\163-".$page3,array( &$this,"\154mm_admin_enqueue_\163\143\162ipts"),7); add_action("admin_prin\164\137\163cripts-".$page5,array( &$this,"\154\155\155_admin_enque\165\145\137scripts"),8); add_action("admin_prin\164\137\163cripts-".$page2,array( &$this,"lmm_a\144\155\151n_selectjs"),011); add_action("\141\144min_print_styl\145\163\055".$page3,array( &$this,"\154mm_admin_selectj\163"),011); add_action("\141\144min_print_sc\162\151\160ts-".$page7,array( &$this,"\154\155m_admin_selectjs"),011); add_action("admin_print_\163\143\162ipts-".$page4,array( &$this,"\154mm_admin_sele\143\164\152s"),011); add_action("admin_print\137\163\143ripts-".$page11,array( &$this,"\154\155m_admin_sele\143\164\152s"),011); add_action("admin_p\162\151\156t_scripts-".$page3,array( &$this,"lmm_ad\155\151\156_ajax_actions\152\163\137backend"),012); add_action("\141\144min_print_scri\160\164\163-".$page5,array( &$this,"lmm_admin_ajax_\141\143\164ionsjs_back\145\156\144"),012); add_action("\141\144\155in_print_styl\145\163\055".$page3,array( &$this,"lmm_admin_enqueue_\163\164\171lesheets_le\141\146\154et"),023); add_action("\141\144\155in_print_styl\145\163\055".$page5,array( &$this,"\154\155m_admin_enque\165\145\137stylesheets_\154\145\141flet"),023); add_action("admin\137\160\162int_styles-".$page,array( &$this,"\154mm_admin_enqueue_\163\164\171lesheets"),021); add_action("a\144\155\151n_print_styles\055".$page2,array( &$this,"\154\155\155_admin_enque\165\145\137stylesheets"),022); add_action("\141\144min_print_style\163\055".$page3,array( &$this,"\154\155\155_admin_enque\165\145\137stylesheet\163"),023); add_action("admin_print_\163\164\171les-".$page3b,array( &$this,"lmm_admin_enqueue\137\163\164y\154\145\163heets"),023); add_action("\141dmin_print_sty\154\145\163-".$page4,array( &$this,"lmm_admin_enque\165\145\137stylesheets"),024); add_action("admin_pri\156\164\137styles-".$page5,array( &$this,"\154\155\155_admin_enqueu\145\137\163tylesheets"),025); add_action("ad\155\151\156_print_styles\055".$page6,array( &$this,"lmm_admi\156\137\145nqueue_styl\145\163\150eets"),026); add_action("admin_p\162\151\156t_styles-".$page7,array( &$this,"\154mm_admin_enqueue\137\163\164ylesheets"),027); add_action("adm\151\156\137print_styles-".$page8,array( &$this,"lmm_admin_en\161\165\145ue_styleshee\164\163"),030); add_action("admin_print_s\164\171\154es-".$page10,array( &$this,"lmm_admin_\145\156\161ueue_styleshe\145\164\163"),031); add_action("admin_print_s\164\171\154es-".$page11,array( &$this,"\154mm_admin_enqu\145\165\145_stylesheets"),032); add_action("\141\144min_print_style\163\055".$page3,array( &$this,"\154\155m_admin_enqueue_\163\164\171lesheets_d\141\164\145picker"),030); add_action("admin_enqueue_sc\162\151\160ts",array( &$this,"lmm_admin\137\145\156queue_stylesh\145\145\164s_adminbar"),031); add_action("ad\155\151\156_print_scripts\055".$page,array( &$this,"\154\155\155_add_contextua\154\137\150elp")); add_action("\141dmin_print_s\143\162\151pts-".$page2,array( &$this,"lmm_add_contextua\154\137\150elp")); add_action("\141dmin_print_sc\162\151\160ts-".$page3,array( &$this,"lmm_add_contextua\154\137\150elp")); add_action("admin_print_scri\160\164\163-".$page3b,array( &$this,"\154\155m_add_context\165\141\154_help")); add_action("admin_print_s\143\162\151pts-".$page4,array( &$this,"\154mm_add_context\165\141\154_help")); add_action("admin_p\162\151\156t_scripts-".$page5,array( &$this,"lmm_add_context\165\141\154_help")); add_action("ad\155\151\156_print_script\163\055".$page6,array( &$this,"\154\155\155_add_context\165\141\154_help")); add_action("admin_print\137\163\143ripts-".$page7,array( &$this,"l\155\155\137add_contextua\154\137\150elp")); add_action("admin_print_\163\143\162ipts-".$page8,array( &$this,"\154\155\155_add_contex\164\165\141l_help")); add_action("admin_print_scri\160\164\163-".$page10,array( &$this,"\154\155\155_add_context\165\141\154_help")); add_action("\141dmin_print_script\163\055".$page3,array( &$this,"lmm_admin_enqueu\145\137\163cripts_jquer\171\144\141tepicker")); add_action("\141\144\155in_print_script\163\055".$page5,array( &$this,"lm\155\137\141dmin_enqueue_sc\162\151\160ts_jquerydat\145\160\151cker")); add_action("admin_print_sc\162\151\160ts-".$page7,array( &$this,"\154mm_admin_bootst\162\141\160_tabs"),011); } function lmm_add_admin_bar_menu() { global $wp_version; $O4=get_option("\154eafletmapsmar\153\145\162_options"); $lo=( isset ($_GET["page"]) ? $_GET["p\141\147\145"]: ""); if ($lo == "le\141\146\154etmapsmarker_\155\141\162ker") { $Oo="#"; } else { $Oo=l1."\141dmin.php?page=lea\146\154\145tmapsmarker\137\155\141rker"; } if ($lo == "leafletmapsmar\153\145\162_layer") { $lp="\043"; } else { $lp=l1."\141dmin.php?page=le\141\146\154etmapsmark\145\162\137layer"; } if ($O4["admin_bar_inte\147\162\141tion"] == "enabled" && current_user_can($O4["capabilities_vie\167\137\157thers"])) { global $wp_admin_bar; if ($O4["misc_\167\150\151telabel_backe\156\144"] == "\145nabled") { $Op=esc_attr__("Ma\160\163","lm\155"); $lq=""; } else { $Op="Maps Marker Pro"; $lq=array("\164\151tle" => "Wordpres\163\055\120lugin ".__("\142y","lmm")." www.mapsm\141\162\153er.com"); } if (version_compare($wp_version,"\063.8-alpha","\076")) { $lm="-white"; $Oq="\074span class=\042\141\142-icon\042>\074\057span><span cl\141\163\163=\042a\142\055label\042>".$Op."</\163\160\141n>"; } else { $Oq="\074img style=\042\146\154\157at:left;m\141\162\147in:3px 5\160\170\0400 0;\042\040\163rc=\042".O1."inc/img/icon-ti\156\171\155ce.png\042\057\076 ".$Op; $lm=""; } $menu_items=array(array("\151\144" => "lmm","\164itle" => $Oq,"\150\162ef" => "","meta" => $lq),array("\151\144" => "lmm-marker\163","pa\162\145\156t" => "l\155\155","\164\151\164le" => "<img src=\042".O1."\151nc/img/icon-menu\055\154\151st".$lm.".p\156\147\042> ".__("\114ist all mark\145\162\163","\154mm"),"\150\162\145f" => l1."\141\144\155in.php?page=l\145\141\146letmapsmark\145\162\137markers"),array("id" => "\154\155m-add-marke\162","\160\141rent" => "lmm","\164itle" => "\074img src=\042".O1."inc/img/icon-menu-a\144\144".$lm."\056png\042> ".__("\101\144d new marker","\154mm"),"href" => $Oo),array("id" => "l\155\155\055import-expor\164","\160\141rent" => "l\155\155","ti\164\154\145" => "\074img src=\042".O1."\151\156c/img/icon-menu\055\151\155port-expor\164".$lm.".png\042\076\040".__("Import/E\170\160\157rt","\154\155\155"),"\150\162\145f" => l1."\141\144min.php?page=le\141\146\154etmapsmarke\162\137\151mport_exp\157\162\164"),array("id" => "\154\155\155-layers","parent" => "lmm","\164itle" => "\074img src=\042".O1."\151\156\143/img/icon-men\165\055\154ist".$lm.".png\042\076\040".__("\114\151\163t all layer\163","lmm"),"\150\162ef" => l1."admin.p\150\160\077page=leafletm\141\160\163marker_laye\162\163"),array("\151d" => "lmm-\141\144\144-layers","\160arent" => "\154\155\155","\164itle" => "\074img src=\042".O1."\151\156\143/img/icon-m\145\156\165-add".$lm.".png\042\076\040".__("\101\144\144 new layer","lmm"),"href" => $lp)); if (current_user_can("activate_plu\147\151\156s") && ($O4["\155\151sc_whitelabe\154\137\142ackend"] == "disabled")) { $menu_items=array_merge($menu_items,array(array("\151\144" => "lmm-t\157\157\154s","parent" => "lmm","\164\151tle" => "<hr style=\042\155\141rgin:3px 0;\042\040\156oshade si\172\145\075\0421\042\057\076<img src=\042".O1."inc/img/icon-menu\055\164\157ols".$lm.".png\042\076\040".__("\124\157ols","lmm"),"\150ref" => l1."admin\056\160\150p?page=leafl\145\164\155apsmarker_t\157\157\154s"),array("id" => "\154\155\155-settings","parent" => "lm\155","titl\145" => "\074img src=\042".O1."i\156\143/img/icon-me\156\165\055settin\147\163".$lm.".png\042\076 ".__("Settings","\154mm"),"href" => l1."admin.php?pa\147\145\075leaflet\155\141\160smarker_set\164\151ngs"),array("id" => "\154\155\155-apis","parent" => "\154\155m","\164\151\164le" => "\074img src=\042".O1."\151\156c/img/icon-me\156\165\055api".$lm."\056\160\156g\042> M\141\160\163 Marker API\163","href" => l1."ad\155\151\156.php?page=leaf\154\145\164mapsmarker\137\141\160is"))); } if ($O4["misc_whitelabel_b\141\143\153end"] == "disabled") { $menu_items=array_merge($menu_items,array(array("id" => "\154\155\155-help-credit\163","parent" => "\154\155\155","\164itle" => "\074img src=\042".O1."\151nc/img/icon-men\165\055\150elp".$lm.".pn\147\042\076 ".__("\123upport","\154mm"),"\150\162ef" => l1."\141\144\155in.php?page=\154\145\141fletmapsmar\153\145\162_help"),array("i\144" => "lmm-license","\160arent" => "\154\155\155","\164itle" => "<hr style=\042\155\141rgin:3px 0;\042\040\156oshade size\075\0421\042/><i\155\147\040src=\042".O1."\151nc/img/icon-me\156\165\055settings".$lm."\056png\042> ".__("License s\145\164\164ings","\154\155m"),"\150\162ef" => l1."admin.\160\150\160?page=leaflet\155\141\160smarker_lic\145\156\163e"))); } foreach ($menu_items as $menu_item) { $wp_admin_bar->add_menu($menu_item); } } } function lmm_add_contextual_help() { $helptext="<p>".__("Do y\157\165\040have ques\164\151\157ns or issues\040\167ith Leaflet Ma\160\163\040Marker? \120\154\145ase use \164\150\145 followi\156\147\040suppo\162\164\040chann\145\154\163 approp\162\151\141tely.","lmm")."<br/>"; $helptext.="\074strong>".__("\102\145\146ore you post \141\040\156ew support\040\164\151cket, ple\141\163\145 follow t\150\145\040instructions\040\146\162om <a \150\162\145f=\042\150\164\164p://ww\167\056\155apsmar\153\145\162.com/re\141\144\155e-firs\164\042 target=\042\137\142lank\042\076\150ttp://w\167\167\056mapsm\141\162\153er.com\057\162eadme-fir\163\164\074/a> w\150\151\143h giv\145\040you a gui\144\145line on h\157\167 to deal\040\167ith the\040\155ost comm\157\156 issues.","\154mm")."\074/strong></p>"; $helptext.="<ul>"; $helptext.="\074\154i><a href=\042\150\164tps://www.maps\155\141\162ker.com/faq\057\042 target=\042\137\142\154ank\042\076".__("\106\101Q","lmm")."</a> (".__("frequently as\153\145\144 questions","lmm")."\051</li>"; $helptext.="<li\076\074\141 href=\042\150\164\164ps://www.\155\141\160smarker.co\155\057\144ocs/\042\040\164arget=\042\137\142\154ank\042\076".__("\104ocumentation","\154mm")."\074/a></li>"; $helptext.="<li><a href=\042\150\164\164ps://www.ma\160\163\155arker.com/\154\157\147in\042 \164\141\162get=\042\137\142\154ank\042\076\155apsmarker.\143\157m/login</a\076\040(".__("\163upport for pr\157\040\165sers","\154mm")."\051\074/li>"; $helptext.="</ul>"; $screen=get_current_screen(); $screen->add_help_tab(array("\151\144" => "\154\155m_help_tab","\164\151tle" => __("Help\040\046\040Support","lmm"),"\143\157ntent" => $helptext)); } function lmm_admin_selectjs() { $O7=get_option("\154\145\141fletmapsmark\145\162\137version_pr\157"); wp_enqueue_script(array("\152\161uery")); wp_enqueue_script("leafletmapsmarker-\154\151\163t-markers-\154\141\171ers",O1."\151\156\143/js/list-mar\153\145\162s-layers.js",array("jque\162\171"),$O7); wp_localize_script("leaf\154\145\164mapsmarker-li\163\164\055markers-la\171\145\162s","l\155\155\137ajax_vars",array("\154\155\155_ajax_nonce" => wp_create_nonce("lmm-\141\152\141x-nonce"),"\154mm_ajax_leafle\164\137\160lugin_url" => O1)); wp_enqueue_script("leafl\145\164\155apsmarker-sel\145\143\1642",O1."\151nc/js/select2/\163\145\154ect2.min.js",array("jquer\171"),$O7); wp_enqueue_style("leafletmapsma\162\153\145r-select2",O1."inc/js/select2/s\145\154\145ct2.css",array(),$O7); wp_localize_script("leafletmapsmarker-s\145\154\145ct2","mapsmarkerjspro",array("\163ettings_search_p\154\141\143eholder" => __("\163tart full-tex\164\040\163earch","\154mm"),"\163\145ttings_search_\156\157\137results" => __("\116o matches fou\156\144","\154\155\155"),"\154\155m_current_page" => ( isset ($_GET["\160\141ge"]) ? $_GET["page"]: ""))); } function lmm_admin_ajax_actionsjs_backend() { $O4=get_option("leafletma\160\163\155arker_optio\156\163"); if ($O4["defaults_marke\162\137\143ustom_icon\137\165\162l_dir"] == "\156\157") { $defaults_marker_icon_url=LEAFLET_PLUGIN_ICONS_URL; } else { $defaults_marker_icon_url=htmlspecialchars($O4["\144efaults_marker_i\143\157\156_url"]); } $O7=get_option("leafletmapsmark\145\162\137version_pro"); wp_enqueue_script(array("jquery")); wp_enqueue_script("\154\145afletmapsmarke\162\055\141jax-action\163\055js-backend",O1."\151\156\143/js/ajax-acti\157\156\163-backend.js",array("\152\161\165ery"),$O7); wp_localize_script("leaflet\155\141\160smarker-ajax-\141\143\164ions-js-bac\153\145\156d","lmm\137\141\152ax_vars",array("lmm_ajax_nonce" => wp_create_nonce("lmm-ajax-nonce"),"\154mm_ajax_curren\164\137\160age" => ( isset ($_GET["page"]) ? $_GET["\160age"]: ""),"\154\155\155_ajax_confirm_\144\145\154ete" => esc_attr__("Do you re\141\154\154y want to del\145\164\145 this marker\077\040(cannot be u\156\144\157ne)","\154\155m"),"\154\155m_ajax_shortcod\145" => htmlspecialchars($O4["shortc\157\144\145"]),"lmm_ajax_l\145\141\146let_plugin_u\162\154" => O1,"lmm_aja\170\137\164ext_no_resul\164\163\137found" => __("No matches fou\156\144","lm\155"),"lmm_ajax_admin_ur\154" => l1,"\154\155\155_ajax_url" => admin_url("admin-a\152\141\170.php"),"\154\155m_ajax_misc_km\154" => $O4["\155isc_kml"],"\154mm_get_directions\137\164\145xt" => esc_attr__("Get directions","\154\155m"),"lmm_dir\145\143\164ions_text" => __("\104\151rections","\154\155m"),"\154\155\155_defaults_m\141\162\153er_icon_url" => $defaults_marker_icon_url)); } function lmm_admin_bootstrap_tabs() { $O7=get_option("leafletmapsmar\153\145\162_version_pr\157"); wp_enqueue_script(array("jquer\171")); wp_enqueue_script("leafletmap\163\155\141rker-bootstra\160\055\164abs",O1."inc/js/\142\157\157tstrap-tabs.m\151\156\056js",array("jquery"),$O7); } function lmm_frontend_enqueue_scripts() { global $locale; $O4=get_option("\154eafletmapsmarke\162\137\157ptions"); $O7=get_option("\154\145afletmapsmarker\137\166\145rsion_pro"); if ($O4["\147oogle_maps_a\160\151\137status"] == "enabl\145\144") { if ($O4["\147oogle_maps_ap\151\137\144eferred_loadi\156\147"] == "enabled") { if ($O4["\155isc_javascri\160\164\137header_footer\137\160\162o"] == "footer") { wp_register_script("leaf\154\145\164mapsmarker-c\157\162\145",O1."leaflet-dist/le\141\146\154et-core.js",array(),$O7,FALSE); wp_register_script("leaflet\155\141\160smarker-addon\163",O1."le\141\146\154et-dist/leafle\164\055\141ddons.js",array("\154\145\141fletmapsmarker\055\143\157re"),$O7,FALSE); wp_register_script("\163\150ow_map",O1."\151\156c/js/show_map.\152\163",array("jquer\171","\154eafletmapsma\162\153\145r-core","leafle\164\155\141psmarker-addons"),$O7,FALSE); } else { wp_enqueue_script("\154\145\141fletmapsmarke\162\055core",O1."\154eaflet-dist/le\141\146\154et-core.js",array(),$O7,FALSE); wp_enqueue_script("leafletmapsmar\153\145\162-addons",O1."leaflet-dist\057\154\145aflet-addon\163\056\152s",array("jquery","\154\145\141fletmapsmarker\055\143\157re"),$O7,FALSE); } } else { if ( isset ($O4["google_m\141\160\163_api_key"]) && ($O4["google_m\141\160\163_api_key"] != NULL)) { $google_maps_api_key="\077\153\145y=".trim($O4["\147oogle_maps_api_ke\171"]); } else { $google_maps_api_key=""; } $lr=(substr($locale,0,2) == "zh") ? "http": "\150\164tps"; if ($O4["\155isc_javascript\137\150\145ader_footer_\160\162\157"] == "f\157\157\164er") { wp_register_script("\154eafletmapsmarke\162\055\147ooglemaps-l\157\141\144er",$lr."\072//www.google.com/\152\163\141pi".$google_maps_api_key,array(),NULL,TRUE); } else { wp_enqueue_script("\154\145\141fletmapsm\141\162\153er-googlema\160\163\055loader",$lr."\072//www.google.com\057\152\163api".$google_maps_api_key,array(),NULL,TRUE); } if ($O4["misc_ja\166\141\163cript_header_\146\157\157ter_pro"] == "\146\157oter") { wp_register_script("leafletm\141\160\163marker-core",O1."\154\145\141flet-dist/le\141\146\154et-core.js",array("leaf\154\145\164mapsmarker-goo\147\154\145maps-loader"),$O7,FALSE); wp_register_script("leafletmapsmarke\162\055\141ddons",O1."leaflet-dist/le\141\146\154et-addons.j\163",array("\154\145afletmapsmarker-\143\157\162e"),$O7,FALSE); wp_register_script("show_map",O1."\151nc/js/show_map.\152\163",array("\154\145afletmapsmar\153\145\162-core","leafletmapsm\141\162\153er-addons"),$O7,FALSE); } else { wp_enqueue_script("\154eafletmapsm\141\162\153er-core",O1."\154eaflet-dist/le\141\146\154et-core.js",array("le\141\146\154etmapsmarker-g\157\157\147lemaps-loader"),$O7,FALSE); wp_enqueue_script("leafletm\141\160\163marker-addons",O1."leaflet-dist/lea\146\154\145t-addons.js",array("leafletm\141\160\163marker-core"),$O7,FALSE); } } } else { if ($O4["\155isc_javascript_\150\145\141der_footer_pr\157"] == "\146ooter") { wp_register_script("\154eafletmapsma\162\153\145r-core",O1."leaflet-dist/le\141\146\154et-core.js",array(),$O7,FALSE); wp_register_script("leafletmapsma\162\153\145r-addons",O1."\154eaflet\055\144\151st/leaflet\055\141\144dons.js",array("\154\145afletmapsmarke\162\055\143ore"),$O7,FALSE); wp_register_script("\163how_map",O1."inc/\152\163\057show_map.js",array("leafletm\141\160\163marker-core","leafletmapsmar\153\145\162-addons"),$O7,FALSE); } else { wp_enqueue_script("\154eafletmapsma\162\153\145r-core",O1."leaflet-dist/leafl\145\164\055core.js",array(),$O7,FALSE); wp_enqueue_script("\154eafletmapsmarker-\141\144\144ons",O1."\154eaflet-dist/l\145\141\146let-addons.j\163",array("\154\145afletmapsmarke\162\055\143ore"),$O7,FALSE); } } $google_styling_json=($O4["g\157\157\147le_styling_js\157\156"] == NULL) ? "disabled": str_replace("\042","\047",$O4["g\157\157\147le_styling_j\163\157\156"]); if ($O4["bingmaps_culture"] == "\141utomatic") { if ($locale != NULL) { $bing_culture=str_replace("_","-",$locale); } else { $bing_culture="\145n_us"; } } else { $bing_culture=$O4["\142ingmaps_cult\165\162\145"]; } if ($O4["google_\155\141\160s_language_\154\157\143alization"] == "\142\162owser_setting") { $google_language=""; } else if ($O4["google_maps_l\141\156\147uage_loca\154\151\172ation"] == "\167\157\162dpress_settin\147") { if ($locale != NULL) { $google_language="\046\154anguage=".substr($locale,0,2); } else { $google_language="\046language=en"; } } else { $google_language="&langu\141\147\145=".$O4["go\157\147\154e_maps_langua\147\145\137localizatio\156"]; } if ($O4["\147oogle_maps_base_d\157\155\141in_custom"] == "") { $gmaps_base_domain="\046\142ase_domain=".$O4["\147oogle_maps_\142\141\163e_domain"]; } else { $gmaps_base_domain="&bas\145\137\144omain=".htmlspecialchars($O4["\147oogle_maps_b\141\163\145_domain_cus\164\157\155"]); } wp_localize_script("\154\145afletmapsmarker-c\157\162\145","mapsmarkerjspro",array("zoom_i\156" => __("Zoom\040\151\156","l\155\155"),"zoom_\157\165\164" => __("\132oom out","\154\155\155"),"g\157\157\147lemaps_language" => $google_language,"\147ooglemaps_li\142\162\141ries" => "","\147\157oglemaps_base_doma\151\156" => $gmaps_base_domain,"google_map\163\137\141pi_key" => trim($O4["googl\145\137\155aps_api_key"]),"\142ing_culture" => $bing_culture,"google_styling\137\152\163on" => $google_styling_json,"google_def\145\162\162ed_loading" => $O4["google\137\155\141ps_api_defer\162\145\144_loading"],"\147\157ogle_script_load\151\156\147" => "frontend","minimap_s\150\157\167" => __("Show minimap","\154\155m"),"\155\151nimap_hide" => __("H\151\144\145 minimap","\154mm"),"fullscreen_\142\165\164ton_title" => __("\126iew fullscreen","lmm"),"ful\154\163\143reen_button_tit\154\145\137exit" => __("\105xit fullscreen","\154mm"),"fulls\143\162\145en_button_posi\164\151\157n" => $O4["\155\141\160_fullscreen_\142\165\164ton_position"],"maxzo\157\155" => intval($O4["\147\154obal_maxzoom_\154\145\166el"]),"google_maps_ap\151\137\163tatus" => $O4["\147\157\157gle_maps_api\137\163\164atus"],"me\164\145\162s" => __("\155\145\164ers","\154\155\155"),"\146\145et" => __("feet","\154\155m"),"g\160\170\137icons_status" => $O4["g\160\170\137icons_status"])); wp_localize_script("leafletm\141\160\163marker-addon\163","\154\155\155_ajax_vars",array("l\155\155\137ajax_nonce" => wp_create_nonce("lmm-aj\141\170\055nonce"),"\154mm_ajax_leaflet_\160\154\165gin_url" => O1,"lmm_aj\141\170\137text_no_result\163\137\146ound" => __("No matches\040\146\157und","\154mm"),"lmm_aja\170\137\165rl" => admin_url("adm\151\156\055ajax.php"))); } function lmm_admin_enqueue_scripts() { global $wp_version,$locale; $O4=get_option("leafletmapsmar\153\145\162_options"); $O7=get_option("\154\145\141fletmapsmark\145\162\137version_pro"); if ($O4["google_maps_la\156\147\165age_l\157\143\141lization"] == "\142\162owser_settin\147") { $google_language=""; } else if ($O4["google_maps_lan\147\165\141ge_localiza\164\151\157n"] == "\167\157\162dpress_settin\147") { if ($locale != NULL) { $google_language="&language=".substr($locale,0,2); } else { $google_language="&langu\141\147\145=en"; } } else { $google_language="\046language=".$O4["\147\157\157gle_maps_lang\165\141\147e_localiza\164\151\157n"]; } if ($O4["google_m\141\160\163_base_domain\137\143\165stom"] != "") { $gmaps_base_domain="&base\137\144\157main=".$O4["g\157\157\147le_maps_base_d\157\155\141in"]; } else { $gmaps_base_domain="\046\142ase_domain=".htmlspecialchars($O4["\147oogle_maps_base_d\157\155\141in_custom"]); } wp_enqueue_script(array("\152\161uery")); $page=( isset ($_GET["page"]) ? $_GET["\160age"]: ""); if ($page == "\154eafletmapsma\162\153\145r_layer") { if (version_compare($wp_version,"3.5","\076\075")) { wp_enqueue_media(); } else { wp_enqueue_style("t\150\151\143kbox"); wp_enqueue_script("\155edia-upload"); wp_enqueue_script("\164\150ickbox"); wp_enqueue_script("\155\145dia-models"); } } if ( isset ($O4["google_maps_api_\153\145\171"]) && ($O4["google_maps_\141\160\151_key"] != NULL)) { $google_maps_api_key="?key=".trim($O4["\147\157ogle_maps_api_\153\145\171"]); } else { $google_maps_api_key=""; } $lr=(substr($locale,0,2) == "zh") ? "\150\164tp": "\150\164\164ps"; if (($O4["\147\157\157gle_maps_a\160\151\137status"] == "enabl\145\144") || ($O4["goog\154\145\137places_status"] == "enable\144")) { wp_enqueue_script("\154eafletmapsmarker\055\147\157oglemaps-l\157\141\144er",$lr."\072//www.google.com/\152\163\141pi".$google_maps_api_key,array(),NULL,TRUE); } $google_styling_json=($O4["goog\154\145\137styling_json"] == NULL) ? "\144\151sabled": str_replace("\042","'",$O4["\147oogle_stylin\147\137\152son"]); if ($O4["bingmaps_c\165\154\164ure"] == "\141utomatic") { if ($locale != NULL) { $bing_culture=str_replace("\137","-",$locale); } else { $bing_culture="en\137\165\163"; } } else { $bing_culture=$O4["\142ingmaps_culture"]; } if ($O4["google_maps_api\137\163\164atus"] == "enabled") { wp_enqueue_script("\154eafletmapsmar\153\145\162-core",O1."leaflet-di\163\164\057leaflet-co\162\145\056js",array("leaf\154\145\164mapsmarker-goo\147\154\145maps-loader"),$O7,FALSE); wp_enqueue_script("\154eafletmapsmarker-\141\144\144ons",O1."\154eaflet-dist/\154\145\141flet-addons.\152\163",array("leaflet\155\141\160smarker-core"),$O7,FALSE); $ls="\145\156\141bled"; } else { wp_enqueue_script("\154\145\141fletmapsmarke\162\055\143ore",O1."\154eaflet-dist/leaflet\055\143\157re.js",array(),$O7,FALSE); wp_enqueue_script("\154\145afletmapsmarker\055\141\144dons",O1."leaflet-dist/leafl\145\164\055addons.js",array("leafletmap\163\155\141rker-core"),$O7,FALSE); $ls="dis\141\142led"; } wp_localize_script("\154\145afletmapsmark\145\162\055core","mapsmarker\152\163\160ro",array("zoom_in" => __("Z\157\157\155 in","\154mm"),"zoom_out" => __("\132\157\157m out","\154mm"),"\147\157oglemaps_languag\145" => $google_language,"\147ooglemaps_lib\162\141\162ies" => "\046libraries=pl\141\143\145s","googlemaps_ba\163\145\137domain" => $gmaps_base_domain,"go\157\147\154e_maps_api_key" => trim($O4["goog\154\145\137maps_api_key"]),"bing_cult\165\162\145" => $bing_culture,"\147\157ogle_styling_j\163\157\156" => $google_styling_json,"google_defer\162\145\144_loading" => $O4["\147\157\157gle_maps_api_\144\145\146erred_loadin\147"],"\147oogle_script_l\157\141\144ing" => "\142ackend","\155inimap_show" => __("Sh\157\167\040minimap","\154\155m"),"mini\155\141\160_hide" => __("Hide \155\151\156imap","\154\155m"),"fu\154\154\163creen_button_t\151\164\154e" => __("View \146\165\154lscreen","\154\155m"),"fulls\143\162\145en_button_titl\145\137\145xit" => __("Exit fullscreen","lmm"),"fullscre\145\156\137button_posi\164\151\157n" => $O4["\155\141p_fullscreen_bu\164\164\157n_position"],"max\172\157\157m" => intval($O4["glo\142\141\154_maxzoom_level"]),"google_maps_api\137\163\164atus" => $ls,"meters" => __("meters","lmm"),"\146\145et" => __("feet","lmm"),"\147\160\170_icons_statu\163" => $O4["\147px_icons_statu\163"])); } function lmm_admin_enqueue_scripts_jquerydatepicker() { $O7=get_option("\154eafletmapsmarke\162\137\166ersion_pro"); wp_enqueue_script("jquery-ui-time\160\151\143ker-addon",O1."\151\156c/js/jquery-ui\055\164\151mepicker-a\144\144\157n.js",array("\152\161\165ery","\152\161uery-ui-tabs","\152query-ui-dat\145\160\151cker","jquery-ui-slider"),$O7); } function lmm_frontend_enqueue_stylesheets() { $O4=get_option("\154\145afletmapsmar\153\145\162_options"); global $wp_query; $posts=$wp_query->posts; $pattern=get_shortcode_regex(); $O7=get_option("\154\145afletmapsmark\145\162\137version_pro"); if (function_exists("is_rtl") && is_rtl()) { $Os="\154eafletmapsmarke\162\055\162tl"; $lt="leaflet-rtl.min.c\163\163"; } else { $Os="leafletmapsma\162\153\145r"; $lt="\154eaflet.min.css"; } wp_register_style($Os,O1."\154\145\141flet-dist/".$lt,array(),$O7); if (is_array($posts)) { foreach ($posts as $post) { if (preg_match_all("/".$pattern."\057s",$post->post_content ,$matches) && array_key_exists(2,$matches) && in_array($O4["\163hortcode"],$matches[2])) { wp_enqueue_style($Os); break; } } $lmm_custom_css="\056leaflet-popup-con\164\145\156t img \173\040".htmlspecialchars($O4["de\146\141\165lts_marker_pop\165\160\163_image_css"])."\040} .marker-cluster\055\163\155all \173\040\142\141ckground-\143\157\154or: ".htmlspecialchars($O4["\143\154ustering_color_\163\155\141ll"])."; } .ma\162\153\145r-cluster-small\040\144\151v \173 b\141\143\153ground-co\154\157\162: ".htmlspecialchars($O4["clustering_color_s\155\141\154l_inner"])."\073\040\143olor: ".htmlspecialchars($O4["\143lustering_co\154\157\162_small_text"])."; }\040\056\155arker-clust\145\162\055medium \173\040\142ackground-co\154\157\162: ".htmlspecialchars($O4["\143lustering_color_\155\145\144ium"])."; } .marke\162\055\143luster-med\151\165\155 div \173\040\142\141ckground-\143\157\154or: ".htmlspecialchars($O4["\143\154ustering_col\157\162\137medium_inner"])."\073\040 color: ".htmlspecialchars($O4["c\154\165\163tering_color\137\155\145dium_text"])."\073\040} .marker-clus\164\145\162-large \173\040\142\141ckground\055\143\157lor: ".htmlspecialchars($O4["clus\164\145\162ing_color_larg\145"])."\073\040} .marker-clu\163\164\145r-large div \173\040\142ackground\055\143\157lor: ".htmlspecialchars($O4["\143\154ustering_colo\162\137\154arge_inner"]).";\040\040\143olor: ".htmlspecialchars($O4["\143lustering_colo\162\137\154arge_text"])."; }"; wp_add_inline_style($Os,$lmm_custom_css); } } function lmm_template_check_shortcode($template) { $O4=get_option("\154\145afletmapsmarker\137\157\160tions"); $searchterm="[".$O4["shortcode"]; $files=array($template,get_stylesheet_directory().DIRECTORY_SEPARATOR."header.php",get_stylesheet_directory().DIRECTORY_SEPARATOR."\146\157oter.php"); if (function_exists("\151s_rtl") && is_rtl()) { $Os="le\141\146\154etmapsmarker-rt\154"; $lt="\154eaflet-rtl.min.\143\163\163"; } else { $Os="le\141\146\154etmapsmarker"; $lt="\154eaflet.min.css"; } foreach ($files as $file) { if (file_exists($file)) { $contents=file_get_contents($file); if (strpos($contents,$searchterm)) { $O7=get_option("\154eafletmapsmarker\137\166\145rsion_pro"); wp_register_style($Os,O1."leaflet-dist/".$lt,array(),$O7); wp_enqueue_style($Os); break; } } } return $template; } function lmm_admin_enqueue_stylesheets() { $O7=get_option("leafle\164\155\141psmarker_ver\163\151\157n_pro"); if (function_exists("is_rtl") && is_rtl()) { wp_register_style("leafletmapsmarker\055\141dmin-rtl",O1."\151nc/css/leafletmap\163\155\141rker-admin-rt\154\056\143ss",array(),$O7); wp_enqueue_style("\154\145afletmapsmarke\162\055\141dmin-rtl"); } else { wp_register_style("\154\145\141fletmapsmark\145\162\055admin",O1."inc/css/leaf\154\145\164mapsmarker-a\144\155\151n.css",array(),$O7); wp_enqueue_style("\154\145afletmapsmarker\055\141\144min"); } } function lmm_admin_enqueue_stylesheets_leaflet() { global $wp_version; $O7=get_option("\154eafletmapsmarke\162\137\166ersion_pro"); if (function_exists("is_rtl") && is_rtl()) { $Os="leaflet\155\141\160smarker-rtl"; $lt="leaflet-r\164\154\056min.css"; } else { $Os="le\141\146\154etmapsmarker"; $lt="\154eaflet.min.css"; } wp_register_style($Os,O1."leaflet-d\151\163\164/".$lt,array(),$O7); wp_enqueue_style($Os); if (version_compare($wp_version,"\063.7",">=")) { $O4=get_option("\154eafletmapsmark\145\162\137options"); $lmm_custom_css=".leaflet-popup\055\143ontent img \173\040".htmlspecialchars($O4["\144efaults_marker_p\157\160\165ps_image_css"])."\040} .marker-cl\165\163\164er-small \173\040\142ackground-col\157\162\072 ".htmlspecialchars($O4["\143\154ustering_color\137\163\155all"])."\073\040} .marker-clust\145\162\055small div \173\040\142ackground-\143\157\154or: ".htmlspecialchars($O4["clustering_color_\163\155\141ll_inner"]).";\040\143\157lor: ".htmlspecialchars($O4["\143\154ustering_color_s\155\141\154l_text"])."\073\040} .marker-clust\145\162\055medium \173\040\142\141ckground-\143\157\154or: ".htmlspecialchars($O4["\143\154ustering_color_\155\145\144ium"])."; } .m\141\162\153er-cluster-m\145\144\151um div \173\040\142\141ckground\055\143\157lor: ".htmlspecialchars($O4["clusteri\156\147\137color_medium\137\151\156ner"])."; color:\040".htmlspecialchars($O4["clusterin\147\137\143olor_medium\137\164\145xt"])."; } .ma\162\153\145r-cluster-la\162\147\145 \173 bac\153\147\162ound-color:\040".htmlspecialchars($O4["\143lustering_color\137\154\141rge"])."; } .marke\162\055\143luster-larg\145\040\144iv \173 \142\141\143kground-co\154\157\162: ".htmlspecialchars($O4["clus\164\145\162ing_color_lar\147\145\137inner"])."; colo\162\072\040".htmlspecialchars($O4["\143\154\165stering_col\157\162\137large_text"])."\073\040\175"; wp_add_inline_style($Os,$lmm_custom_css); } } function lmm_admin_enqueue_stylesheets_datepicker() { $O7=get_option("\154eafletmapsm\141\162\153er_version_p\162\157"); wp_register_style("leafletmapsmarker\055\152\161uery-ui-cu\163\164\157m",O1."inc\057\143\163s/jquery-dat\145\160\151cker-theme/j\161\165\145ry-ui-cus\164\157\155.css",array(),$O7); wp_enqueue_style("leaf\154\145\164mapsmarker-\152\161\165ery-ui-custo\155"); } function lmm_admin_enqueue_stylesheets_adminbar() { $O4=get_option("\154\145\141fletmapsmarker\137\157\160tions"); if ($O4["admin_b\141\162\137integration"] == "\145\156\141bled" && current_user_can($O4["cap\141\142\151lities_view_o\164\150\145rs"])) { $O7=get_option("leafletmapsm\141\162\153er_version_p\162\157"); wp_register_style("\154eafletmapsmarke\162\055\141dmin-adminb\141\162",O1."inc/css/leaflet\155\141\160smarker-adm\151\156\055adminbar.\143\163\163",array(),$O7); wp_enqueue_style("leafletmapsm\141\162\153er-admin-adm\151\156\142ar"); } } function lmm_install_and_updates() { $current_version="vp273"; $schedule_transient="\154\145afletmapsmar\153\145\162_install_upd\141\164\145_cache_".$current_version; $install_update_schedule=get_transient($schedule_transient); if ($install_update_schedule === FALSE) { $schedule_transient="\154eafletmapsmarke\162\137\151nstall_upda\164\145\137cache_".$current_version; set_transient($schedule_transient,"execute \151\156\163tall and upda\164\145\055routine o\156\154\171 once a d\141\171",074*074*030); include ("\151nc".DIRECTORY_SEPARATOR."\151nstall-and-upda\164\145\163.php"); } } function lmm_plugin_meta_links() { define( "FB_BASENAME" ,plugin_basename( __FILE__)); define( "FB_BASEFOLDER" ,plugin_basename(dirname( __FILE__))); define( "FB_FILENAME" ,str_replace(FB_BASEFOLDER."\057","",plugin_basename( __FILE__))); function leafletmapsmarker_filter_plugin_meta($links,$file) { if ($file == FB_BASENAME) { array_unshift($links,"<a href=\042".l1."\141dmin.php?page\075\154\145afletmapsm\141\162\153er_markers\042\076".__("Markers","\154\155m")."\074/a>","\074a href=\042".l1."\141dmin.php?page=le\141\146\154etmapsmark\145\162\137layers\042\076".__("\114ayers","\154\155\155")."</a>","\074\141 href=\042".l1."\141\144min.php?page=leafle\164\155\141psmarker_\163\145\164tings\042\076".__("\123ettings","\154mm")."\074/a>","\074a href=\042".l1."\141dmin.php?page\075\154\145afletmapsm\141\162\153er_license\042\076".__("Licen\163\145","\154\155\155")."</a>"); } return $links; } add_filter("plugin_actio\156\137\154inks","leafletmapsmarker\137\146\151lter_plugin_m\145\164\141",012,2); } function lmm_add_kml_to_sitemap() { if (class_exists("\107\157ogleSitemap\107\145\156erator")) { global $wpdb; $table_name_markers=$wpdb->prefix."le\141\146\154etmapsmarker_\155\141\162kers"; $Ot=$wpdb->prefix."le\141\146\154etmapsmarker_\154\141\171ers"; $O4=get_option("leafl\145\164\155apsmarker_opt\151\157\156s"); $lu=googlesitemapgenerator::getinstance(); if (($O4["xml_sitemaps_incl\165\144\145"] == "both") || ($O4["\170ml_sitemaps_inclu\144\145"] == "\155arkers")) { $Ou="\123ELECT m.id as \155\151\144, m.created\157\156\040as mcreat\145\144\157n, m.upda\164\145\144on as mu\160\144\141tedon FR\117\115\040`".$table_name_markers."\140\040AS m"; if ($O4["\170\155l_sitemaps_e\170\143\154ude_markers"] != NULL) { if (preg_match("\057^\134d(?:,\134\144\051*\044/",str_replace("\054 ",",",trim($O4["\170ml_sitemaps_exc\154\165\144e_markers"]))) == TRUE) { $Ou.="\040\127\110ERE m.id N\117\124\040IN (".str_replace("\054\040","\054",trim($O4["x\155\154\137sitemaps_exc\154\165\144e_markers"])).")"; } } $lv=$wpdb->get_results($Ou,ARRAY_A); foreach ($lv as $Ov) { if (($Ov["\155updatedon"] == NULL) || ($Ov["mup\144\141\164edon"] == "\060000-00-00 00:\060\060\07200")) { $lw=strtotime($Ov["\155\143reatedon"]); } else { $lw=strtotime($Ov["mupdatedon"]); } $lu->addurl(LEAFLET_PLUGIN_URL."leaflet-kml.php\077\155\141rker=".$Ov["mid"],$lw,$O4["xml_sit\145\155\141ps_change_freq\165\145\156cy_markers"],$O4["xml_sitemaps\137\160\162iority_mark\145\162\163"]); } } if (($O4["\170\155l_sitemaps_i\156\143\154ude"] == "both") || ($O4["\170ml_sitemaps_inclu\144\145"] == "\154\141yers")) { $Ow="\123ELECT l.id as li\144\054\040l.created\157\156\040as lcreat\145\144\157n, l.upda\164\145\144on as lu\160\144\141tedon F\122\117M `".$Ot."` AS l WHERE \154\056\151d != 0"; if ($O4["xml_sitemaps_exc\154\165\144e_layers"] != NULL) { if (preg_match("/^\134\144\050?:,\134d)*\044\057",str_replace("\054\040",",",trim($O4["xml_si\164\145\155aps_exclude_\154\141\171ers"]))) == TRUE) { $Ow.="\040AND l.id NOT IN\040\050".str_replace(", ","\054",trim($O4["\170\155l_sitemaps_\145\170\143lude_layers"])).")"; } } $lx=$wpdb->get_results($Ow,ARRAY_A); foreach ($lx as $Ox) { if (($Ox["lupdatedon"] == NULL) || ($Ox["\154\165pdatedon"] == "0000-00-00 00:00:\060\060")) { $lw=strtotime($Ox["\154createdon"]); } else { $lw=strtotime($Ox["lupdat\145\144\157n"]); } $lu->addurl(LEAFLET_PLUGIN_URL."le\141\146\154et-kml.php?lay\145\162\075".$Ox["lid"],$lw,$O4["x\155\154\137sitemaps_cha\156\147\145_frequency\137\154\141yers"],$O4["xml_sitem\141\160\163_priority_\154\141\171ers"]); } } } } } if (is_admin()) { $lo= isset ($_GET["page"]) ? $_GET["page"]: ""; $ly=array("leaf\154\145\164mapsmarker_\155\141\162kers","lea\146\154\145tmapsmarker_mar\153\145\162","leafletmapsmark\145\162\137import_expor\164","\154\145afletmapsmarker_l\141\171\145rs","\154eafletmapsmarke\162\137\154ayer","\154eafletmapsmarke\162\137\164ools","\154eafletmapsmarker_s\145\164\164ings"); if ((in_array($lo,$ly)) && (O3() === FALSE)) { if (Oy() !== TRUE) { exit (header("Location: ".l1."\141\144min.php?page=lea\146\154\145tmapsmarker\137\154\151cense")); } if (Oc($ld=l0,$Od=FALSE) === FALSE) { $lz=array("leafletmapsmar\153\145\162_markers","leafletmapsm\141\162\153er_marker","leafletmapsmarker\137\151\155port_export","leafletmapsm\141\162\153er_layers","\154eafletmapsmar\153\145\162_layer","leafletmapsmark\145\162\137tools","\154eafletmapsmarker_se\164\164\151ngs","\154eafletmapsmarke\162\137\141pis"); if (in_array($lo,$lz)) { echo "<script t\171\160\145=\042text\057\152\141vascript\042\076\167indow.loc\141\164\151on.href =\040\042".l1."a\144\155\151n.php?page=le\141\146\154etmapsmarke\162\137\154icense&er\162\157\162=le\042\073\074\057script\076\040\040"; } } } } function Oz($l10,$is_theme=FALSE) { $O10=""; if ( isset ($_GET["page"])) { $O10=$_GET["page"]; } elseif ( isset ($_POST["page"])) { $O10=$_POST["\160\141ge"]; } $l11=in_array($O10,$l10); if ($is_theme) { return $l11; } $O11=in_array(plugin_basename( __FILE__),get_option("\141\143tive_plugins")); return ($l11 && $O11); } function Oy($l12=FALSE) { $O12=new l13; $O12->O13 ="database"; $O12->l14 =array("\154ocal_key" => get_option("leafletmapsmarke\162\160\162o_license_\154\157\143al_key")); $O12->O14 =array("func\164\151\157n" => "\165pdate_option","key" => "\154\145\141fletmapsmarkerp\162\157\137license_loc\141\154\137key"); $O12->l15 ="1,\062\054\063,4,5,6,7,\070\054\071,10"; $O12->O15 =get_option("\154\145\141fletmapsmarker\160\162\157_license_key"); $O12->l16 ="\067ca99e156b5e30e\060\06648f49b81178cd7e"; $O12->O16 ="\150\164tps://www.map\163\155\141rker.com/stor\145\057\141pi/index\056\160\150p"; $O12->validate(); if ($l12) { return $O12; } $l10=array("\154\145afletmapsmarke\162\137\155arkers","leafletmapsmar\153\145\162_marker","leafletmapsmark\145\162\137import_export","leafletma\160\163\155arker_layers","leafletmapsmark\145\162\137layer","\154eafletmapsmarker_\164\157\157ls","\154\145\141fletmapsmarke\162\137\163ettings"); if (is_admin() && Oz($l10,TRUE) && $O12->l17) { return $O12->l17; } return TRUE; } function Oc($ld=FALSE,$Od=FALSE) { $O12=new l13; if ($ld !== FALSE) { $O12->ld =strrev(substr($ld,1,012)); } $O12->O13 ="database"; $O12->l14 =array("\154\157\143al_key" => get_option("leafletmapsmarkerp\162\157\137license_loca\154\137\153ey")); $O12->O14 =array("function" => "\165\160\144ate_option","ke\171" => "\154eafletmapsmarkerpr\157\137\154icense_local\137\153\145y"); $O12->l15 ="1,2,3,4,5,6,7,8\054\071,10"; $O12->O15 =get_option("leafletmaps\155\141\162kerpro_licen\163\145\137key"); $O12->l16 ="7ca99e156b5e30e0648\146\064\071b81178cd7\145"; $O12->O16 ="https:/\057\167\167w.mapsmarker\056\143\157m/store/api/\151\156\144ex.php"; $O12->validate(); if ($Od !== FALSE) { if ($O12->l17) { return FALSE; } else { return TRUE; } } if ($O12->l17) { return FALSE; } if ($ld === FALSE) { $O17=$O12->l18["down\154\157\141d_access_exp\151\162\145s"]; $O18=$O12->l18["support_ac\143\145\163s_expires"]; $l19=abs(($O17>$O18) ? $O17: $O18); if (!O19()) { if ($O12->l18["license_\145\170\160ires"] == "never") { return FALSE; } if (time()>$O12->l18["licen\163\145\137expires"]) { return FALSE; } return TRUE; } return ($l19>time()) ? TRUE: FALSE; } else if ($ld !== FALSE) { $O17=$O12->l18["dow\156\154\157ad_access_ex\160\151\162es"]; $O18=$O12->l18["\163\165pport_access_exp\151\162\145s"]; $l19=abs(($O17>$O18) ? $O17: $O18); if (!O19()) { if ($O12->l18["\154\151\143ense_expire\163"] == "\156\145\166er") { return FALSE; } if (time()>$O12->l18["\154\151cense_expires"]) { return FALSE; } return TRUE; } if ($O12->ld >$l19) { return FALSE; } else { return TRUE; } } } function lmm_validate_license_info($release_date_info=FALSE,$license_only_info=FALSE) { $spbas_info=new l13; if ($release_date_info !== FALSE) { $spbas_info->release_date_info =strrev(substr($release_date_info,1,012)); } $spbas_info->O13 ="\144\141tabase"; $spbas_info->l14 =array("local_k\145\171" => get_option("leafletmapsmarker\160\162\157_license_lo\143\141\154_key")); $spbas_info->O14 =array("fu\156\143\164ion" => "\165\160\144ate_option","ke\171" => "\154eafletmapsmarke\162\160\162o_license_loc\141\154\137key"); $spbas_info->l15 ="1,2,3,4,5,6,7,8\054\071,10"; $spbas_info->O15 =get_option("\154\145afletmapsmarkerpr\157\137\154icense_key"); $spbas_info->l16 ="7ca99e156b5e30e06\064\070f49b81178cd7e"; $spbas_info->O16 ="https://w\167\167\056mapsmarker.c\157\155\057store/api/in\144\145\170.php"; $spbas_info->validate(); if ($license_only_info !== FALSE) { if ($spbas_info->l17) { return FALSE; } else { return TRUE; } } if ($spbas_info->l17) { return FALSE; } if ($release_date_info === FALSE) { $download_expires_info=$spbas_info->l18["downloa\144\137\141ccess_expir\145\163"]; $support_expires_info=$spbas_info->l18["\163\165\160port_access_ex\160\151\162es"]; $expires_info=abs(($download_expires_info>$support_expires_info) ? $download_expires_info: $support_expires_info); if (!O19()) { if ($spbas_info->l18["licen\163\145\137expires"] == "never") { return FALSE; } if (time()>$spbas_info->l18["\154icense_expir\145\163"]) { return FALSE; } return TRUE; } return ($expires_info>time()) ? TRUE: FALSE; } else if ($release_date_info !== FALSE) { $download_expires_info=$spbas_info->l18["\144ownload_access_\145\170\160ires"]; $support_expires_info=$spbas_info->l18["suppo\162\164\137access_expires"]; $expires_info=abs(($download_expires_info>$support_expires_info) ? $download_expires_info: $support_expires_info); if (!O19()) { if ($spbas_info->l18["\154\151\143ense_expires"] == "never") { return FALSE; } if (time()>$spbas_info->l18["license_expires"]) { return FALSE; } return TRUE; } if ($spbas_info->ld >$expires_info) { return FALSE; } else { return TRUE; } } } function O19($prefix="\115apsMarkerPro-") { return substr(get_option("leafletmaps\155\141\162kerpro_lice\156\163\145_key"),0,strlen($prefix)) == $prefix; } function lmm_pro_version_info($prefix="\115\141psMarkerPro-") { return substr(get_option("\154\145afletmapsmarkerp\162\157\137license_key"),0,strlen($prefix)) == $prefix; } function l1a($prefix="MapsMarkerP\162\157\0555P-") { return substr(get_option("\154\145afletmapsmarkerp\162\157\137license_key"),0,strlen($prefix)) == $prefix; } function O1a($prefix="MapsMarker\120\162\157-25P-") { return substr(get_option("\154\145afletmapsma\162\153\145rpro_license\137\153\145y"),0,strlen($prefix)) == $prefix; } function l1b($prefix="\115\141psMarkerPro-100P\055") { return substr(get_option("leafletmapsma\162\153\145rpro_licens\145\137\153ey"),0,strlen($prefix)) == $prefix; } function O1b($prefix="MapsMarkerPro-2\065\060P-") { return substr(get_option("leaflet\155\141\160smarkerpro_l\151\143\145nse_key"),0,strlen($prefix)) == $prefix; } function l1c($prefix="MapsMarkerPro-\065\0600P-") { return substr(get_option("\154\145\141fletmapsmarke\162\160\162o_license_ke\171"),0,strlen($prefix)) == $prefix; } function O1c($prefix="MapsMarkerPro-100\060\120\055") { return substr(get_option("leafletma\160\163\155arkerpro_lic\145\156\163e_key"),0,strlen($prefix)) == $prefix; } function l1d($attribute) { if ( isset ($_POST[$attribute]) && ($_POST[$attribute] == TRUE)) { return $_POST[$attribute]; } global $current_user; wp_get_current_user(); switch ($attribute) { case "maps_marke\162\137\160ro_first_na\155\145": return $current_user->user_firstname; case "maps_marker_pro_\154\141\163t_name": return $current_user->user_lastname; case "\155\141\160s_marker_pro_\145\155\141il": return $current_user->user_email; } return ""; } function maps_marker_pro_license_activation_page() { if ( isset ($_POST["\155\141ps_marker_pro_reg\151\163\164er_free"])) { $O12=new l13; $O1d=""; $l1e=array(); if (!$_POST["\155\141ps_marker_pro\137\146\151rst_name"]) { $l1e[]=__("Plea\163\145\040enter your \146\151\162st name to \143\157\156tinue.","\154\155\155"); } if (!$_POST["\155aps_marker_pro_la\163\164\137name"]) { $l1e[]=__("\120\154\145ase enter yo\165\162\040last name \164\157\040continue.","\154\155\155"); } if (!$_POST["maps_marke\162\137\160ro_email"]) { $l1e[]=__("P\154\145\141se enter your\040\145\155ail to con\164\151\156ue.","lmm"); } if (sanitize_email($_POST["\155aps_marker_pr\157\137\145mail"]) !== $_POST["\155aps_marker_pr\157\137\145mail"]) { $l1e[]=__("\120\154\145ase enter a v\141\154\151d email to c\157\156\164inue (or \147\145\164 an anony\155\157\165s trial \154\151\143ense key\051","\154mm"); } if (!$_POST["maps_m\141\162\153er_pro_tos"]) { $l1e[]=__("You must\040\141\147ree to the \124\117\123 to continu\145\056","lmm"); } if (empty($l1e)) { $qs="\155od=3rd_party&\164\141\163k=api&api_k\145\171\07550a209431\064\146\142c82e712b\063\146\071b21f007\064\065&email=".urlencode(sanitize_email($_POST["maps_mar\153\145\162_pro_email"]))."&first_name=".urlencode($_POST["maps_marker_pro\137\146\151rst_name"])."&last_nam\145\075".urlencode($_POST["\155\141ps_marker_pro_la\163\164\137name"])."&company_n\141\155\145=".urlencode($_POST["maps_mark\145\162\137pro_first_na\155\145"])."\04520".urlencode($_POST["\155aps_marker_pr\157\137\154ast_name"])."&user\156\141\155e=".strtolower(sanitize_user($_POST["\155aps_marker_\160\162\157_last_name"],$O1e=TRUE).substr(sanitize_user($_POST["\155aps_marker_pro\137\146\151rst_name"],$O1e=TRUE),0,1)); $l1f=$O12->O1f("\150\164tps://www.ma\160\163\155arker.com/st\157\162\145/api/index.\160\150\160",$qs); if (strtolower(substr($l1f,0,021)) == "\143\157\156nection err\157\162\072") { $l1e[]=$l1f; } else if (strtolower(substr($l1f,0,5)) == "error") { $l1e[]=$l1f; } else { $l1f=json_decode($l1f); update_option("le\141\146\154etmapsmarker\160\162\157_license_ke\171",$O12->O15 =$l1f[0]); update_option("leafletmapsmark\145\162\160ro_licens\145\137\154ocal_key",""); update_option("leafl\145\164\155apsmarkerpro\137\154\151cense_key\137\164\162ial",$O12->O15 =$l1f[0]); $O1d=__("Your new lice\156\163\145 was regist\145\162\145d successfu\154\154\171!","\154\155m"); } } } else if ( isset ($_POST["maps_marke\162\137\160ro_register\137\146\162ee_anonym"])) { $O12=new l13; $O1d=""; $l1e=array(); if (!$_POST["maps_marker_pro_to\163"]) { $l1e[]=__("\131ou must agree to t\150\145\040TOS to co\156\164\151nue.","lmm"); } if (empty($l1e)) { $qs="\155\157\144=3rd_party&\164\141\163k=api&api_k\145\171\075f8b3782fe\146\062\065c3f68e8\060\071f621d193063"; $l1f=$O12->O1f("https://www.maps\155\141\162ker.com/st\157\162\145/api/index.\160\150\160",$qs); if (strtolower(substr($l1f,0,021)) == "connection error\072") { $l1e[]=$l1f; } else if (strtolower(substr($l1f,0,5)) == "\145rror") { $l1e[]=$l1f; } else { $l1f=json_decode($l1f); update_option("l\145\141\146letmapsmarker\160\162\157_license_\153\145\171",$O12->O15 =$l1f[0]); update_option("le\141\146\154etmapsmarkerp\162\157\137license_lo\143\141\154_key",""); update_option("l\145\141\146letmapsmarker\160\162\157_license_k\145\171\137trial",$O12->O15 =$l1f[0]); $O1d=__("\131\157\165r new license\040\167\141s registe\162\145\144 successf\165\154\154y!","lmm"); } } } else { if (!function_exists("wp_verify_nonce")) { require_once (ABSPATH."\167p-includes/plu\147\147\141ble.php"); } $l1g=( isset ($_POST["maps\137\155\141rker_pro_lic\145\156\163e"]) && wp_verify_nonce($_POST["\155aps_marker_\160\162\157_license"],"\155aps_marker_pro_\154\151\143ense")); if ($l1g) { update_option("leafletmapsmar\153\145\162pro_license_\154\157\143al_key",""); update_option("leafletmapsmark\145\162\160ro_license_ke\171",$_POST["leafl\145\164\155apsmarkerpro_\154\151\143ense_key"]); } $O12=Oy(TRUE); } include dirname( __FILE__)."\057\154\145aflet-license.\160\150\160"; return TRUE; } class l13 { public $l17; public $O1g; public $O15; public $O16; public $l1h; public $O1h; public $O13; public $l14; public $O14; public $l1i; public $O1i; public $l15; public $l1j; public $O1j; public $ld; public $l18; public $l1k; public $O1k; function __construct() { $this->l17 =FALSE; $this->O1g =""; $this->l1h =0120; $this->O1h =012; $this->l1l =array("\163\160bas"); $this->O1l ="\163\160bas"; $this->O13 ="filesystem"; $this->l15 =0; $this->l1j =0; $this->l14 =FALSE; $this->O14 =FALSE; $this->l1i =""; $this->O1i ="\154\151cense.txt"; $this->O1j =FALSE; $this->ld =FALSE; $this->O1k =FALSE; $this->l18 =array("custom_fiel\144\163" => array(),"\144\157wnload_access_exp\151\162\145s" => 0,"\154\151cense_expires" => 0,"local_key_expires" => 0,"\163tatus" => "Invalid",); $this->l1k =array("\141\143tive" => __("\124his license\040\151\163 active.","lmm"),"\163uspended" => sprintf(__("\105\162ror: This licen\163\145\040has been s\165\163\160ended. Th\151\163\040usually\040\150\141ppens wh\145\156\040someon\145\040tries to re\147\151ster a seco\156\144\040trial \154\151\143ense fo\162\040the same \144\157\155ain. <a\040\150ref=\042\045\061s\042 \164\141rget=\042\137\142lank\042>\120\154ease clic\153\040here to g\145\164 a non-ex\160\151\162ing li\143\145nse for t\150\151s domain.\074\057a>","lmm"),"https://www.mapsma\162\153\145r.com/orde\162"),"\145xpired" => sprintf(__("Your free 30 \144\141\171 trial licen\163\145\040key has e\170\160\151red. <a h\162\145\146=\042%1\163\042 target=\042\137\142lank\042\076\120lease purc\150\141\163e a va\154\151\144 pro li\143\145\156se key\040\164\157 conti\156\165\145</a>.","lmm"),"https://www.mapsma\162\153\145r.com/order"),"pe\156\144\151ng" => __("\105\162\162or: This li\143\145\156se is pendin\147\040\162eview.","\154\155m"),"\144\157\167nload_acces\163\137\145xpired" => __("Error: \124\150\151s version of t\150\145\040software w\141\163\040released \141\146\164er your d\157\167\156load acc\145\163\163 expire\144\056 Please re\156\145\167 your \144\157\167nload a\156\144\040suppor\164\040access or d\157\167\156grade \164\157 a previou\163\040version.","\154\155\155"),"miss\151\156\147_license_key" => __("Please enter a li\143\145\156se key to c\157\156\164inue.","lmm"),"\165nknown_local_key_t\171\160\145" => __("Error\072\040\101n unknown typ\145\040\157f local ke\171\040\166alidation\040\167\141s reques\164\145\144.","\154\155m"),"\143\157\165ld_not_obtain\137\154\157cal_key" => sprintf(__("\105\162ror: a new lo\143\141\154 license key\040\143\157uld not b\145\040\157btained.\040\120\154ease se\145\040%s for more\040\151nformation","l\155\155"),"\074\141 href=\042\150\164\164ps://www.map\163\155\141rker.com/c\157\156\156ect-errors\042\040\164arget=\042\137\142lank\042\076\155apsmarker.\143\157\155/connec\164\055errors</a>"),"\155\141\170imum_grace_p\145\162\151od_expired" => __("Error: The ma\170\151\155um local l\151\143\145nse key gra\143\145\040period ha\163\040\145xpired.","lmm"),"local\137\153\145y_tampering" => __("\105rror: The local \154\151\143ense key ha\163\040\142een tampe\162\145\144 with or \151\163\040invalid\056","\154\155m"),"loc\141\154\137key_invalid_for\137\154\157cation" => __("Error: The\040\154\157cal license \153\145\171 is invalid \146\157\162 this loca\164\151\157n.","\154mm"),"missi\156\147\137license_file" => __("\105\162ror: Please c\162\145\141te the follow\151\156\147 file (an\144\040\144irectorie\163\040\151f they \144\157\040not ex\151\163\164 alread\171\051:<br />\134\162\134n<br />\134\162\134n","l\155\155"),"license_file\137\156\157t_writable" => __("Error: Plea\163\145\040make the f\157\154\154owing path\040\167\162itable:<\142\162\040/>","\154mm"),"\151\156\166alid_local_ke\171\137\163torage" => __("\105\162ror: the lo\143\141\154 key storage \157\156\040clear cou\154\144\040not determ\151\156\145d.","\154mm"),"\143\157\165ld_not_save_loc\141\154\137key" => __("\105\162\162or: the loca\154\040\154icense key \143\157\165ld not save\144\056","lmm"),"\154\151\143ense_key_str\151\156\147_mismatch" => __("\105rror: The l\157\143\141l key is inv\141\154\151d for thi\163\040\154icense.","\154\155m"),); $this->localization =array("active" => __("This licen\163\145\040is active.","lmm"),"\163uspended" => sprintf(__("\105\162\162or: This licens\145\040\150as been su\163\160\145nded. Thi\163\040\165sually h\141\160\160ens when\040\163\157meone t\162\151\145s to r\145\147\151ster a \163\145\143ond tr\151\141\154 licens\145\040for the sa\155\145\040domain\056\040<a href=\042\045\061s\042\040\164arget=\042\137\142lank\042\076\120lease cli\143\153\040here \164\157 get a no\156\055expiring \154\151cense for\040\164his dom\141\151n.</a>","lmm"),"https://www.maps\155\141\162ker.com/order"),"\145\170\160ired" => sprintf(__("Your free 3\060\040\144ay trial l\151\143\145nse key has e\170\160\151red. <a \150\162\145f=\042%\061\163\042 targe\164\075\042_blan\153\042>Please pu\162\143\150ase a v\141\154\151d pro \154\151\143ense ke\171\040to continu\145\074\057a>.","lmm"),"https://www.\155\141\160smarker.com/o\162\144\145r"),"pe\156\144\151ng" => __("\105\162\162or: This lice\156\163\145 is pending\040\162\145view.","\154\155m"),"\144\157\167nload_access_\145\170\160ired" => __("\105rror: This vers\151\157\156 of the sof\164\167\141re was re\154\145\141sed after\040\171\157ur down\154\157\141d acce\163\163\040expire\144\056 Please re\156\145\167 your \144\157\167nload a\156\144\040suppo\162\164\040acces\163\040or downgr\141\144\145 to a \160\162\145vious \166\145\162sion.","\154mm")); } function validate() { if (!$this->O15) { return $this->l17 =$this->l1k["missing_license_k\145\171"]; } if (!in_array(strtolower($this->O1l),$this->l1l)) { return $this->l17 =$this->l1k["unknow\156\137\154ocal_key_ty\160\145"]; } $this->l1m =$this->l1k["\143\157uld_not_obtain\137\154\157cal_key"]; switch ($this->O13) { case "\144\141\164abase": $O1m=$this->l1n(); break; case "\146ilesystem": $O1m=$this->O1n(); break; default : return $this->l17 =$this->l1k["\155\151ssing_license\137\153\145y"]; } if ($this->l17 == $this->l1m && $this->l15) { $l1o=$this->O1o($this->l1j); if ($l1o["write"]) { if ($this->O13 == "\144\141\164abase") { $this->l1p($l1o["\154ocal_key"]); } elseif ($this->O13 == "\146\151lesystem") { $this->O1p($l1o["l\157\143\141l_key"],"{$this->l1i}{$this->O1i}"); } } if ($l1o["\145\162\162ors"]) { return $this->l17 =$l1o["\145\162\162ors"]; } $this->l17 =FALSE; return $this; } if ($this->l17) { return $this->l17; } return $this->l1q($O1m); } function O1q($l1r,$l1o) { return (( integer) $l1r+(( integer) $l1o*0250600)); } function O1o($O1m) { $O1r=$this->l1s($O1m); $O1s=$this->l1t($O1r); $l18=unserialize($O1s[0]); $l1r=( integer) $l18["\154ocal_key_exp\151\162\145s"]; unset ($O1s,$l18); $O1t=FALSE; $O1s=explode("\012\012",$O1m); $O1m=$O1s[0]; foreach ($l15=explode(",",$this->l15) as $l1u => $l1o) { if (!$l1u) { $O1m.="\012"; } if ($this->O1q($l1r,$l1o)>time()) { continue; } $O1m.= "\012{$l1o}"; $O1t=TRUE; } if (time()>$this->O1q($l1r,array_pop($l15))) { return array("write" => FALSE,"\154ocal_key" => "","erro\162\163" => $this->l1k["\155aximum_grace_p\145\162\151od_expired"]); } return array("\167\162ite" => $O1t,"\154\157cal_key" => $O1m,"\145\162rors" => FALSE); } function O1u($O1m,$l1r) { $l1o=$this->l1t($O1m,"\012\012"); if (! isset ($l1o[1])) { return -1; } return ( integer)($this->O1q($l1r,array_pop(explode("\012",$l1o[1])))-time()); } function l1s($O1m) { return base64_decode(str_replace("\012","",urldecode($O1m))); } function l1t($O1m,$l1v="\173spbas}") { return explode($l1v,$O1m); } function O1v($l1u,$l1w) { return in_array($l1u,(array) $l1w); } function wildcard_ip($l1u) { $octets=explode("\056",$l1u); array_pop($octets); $ip_range[]=implode(".",$octets).".\052"; array_pop($octets); $ip_range[]=implode(".",$octets)."\056\052"; array_pop($octets); $ip_range[]=implode(".",$octets)."\056\052"; return $ip_range; } function wildcard_domain($l1u) { return "\052\056".str_replace("w\167\167\056","",$l1u); } function wildcard_server_hostname($l1u) { $hostname=explode(".",$l1u); unset ($hostname[0]); $hostname=(! isset ($hostname[1])) ? array($l1u): $hostname; return "\052.".implode("\056",$hostname); } function extract_access_set($instances,$enforce) { foreach ($instances as $l1u => $instance) { if ($l1u != $enforce) { continue; } return $instance; } return array(); } function l1q($O1m) { $O1r=$this->l1s($O1m); $O1s=$this->l1t($O1r); if (! isset ($O1s[1])) { return $this->l17 =$this->l1k["\154\157cal_key_tamperi\156\147"]; } if (md5($this->l16.$O1s[0]) != $O1s[1]) { return $this->l17 =$this->l1k["\154ocal_key_tampe\162\151\156g"]; } $l18=unserialize($O1s[0]); $instance=$l18["in\163\164\141nce"]; unset ($l18["\151\156\163tance"]); $enforce=$l18["\145\156force"]; unset ($l18["enforce"]); $this->l18 =$l18; if (( string) $l18["licen\163\145\137key_string"] != ( string) $this->O15) { return $this->l17 =$this->l1k["\154icense_key_strin\147\137\155ismatch"]; } if (( string) $l18["status"] != "\141ctive") { return $this->l17 =$this->l1k[$l18["status"]]; } if (( string) $l18["license_exp\151\162\145s"] != "never" && ( integer) $l18["license_exp\151\162\145s"]<time()) { return $this->l17 =$this->l1k["\145xpire\144"]; } if (( string) $l18["\154\157cal_key_expi\162\145\163"] != "nev\145\162" && ( integer) $l18["\154\157\143al_key_expires"]<time()) { if ($this->O1u($O1m,$l18["l\157\143\141l_key_expire\163"])<0) { $this->O1w(TRUE); return $this->validate(); } } if ($this->O1j && ( integer) $l18["\144\157wnload_acces\163\137\145xpires"]<strtotime($this->ld)) { return $this->l17 =$this->l1k["\144ownload_acce\163\163\137expired"]; } $conflicts=array(); $l1x=$this->O1x(); foreach ((array) $enforce as $l1u) { $l1w=$this->extract_access_set($instance,$l1u); if (!$this->O1v($l1x[$l1u],$l1w)) { $conflicts[$l1u]=TRUE; if (in_array($l1u,array("ip","\163\145\162ver_ip"))) { foreach ($this->wildcard_ip($l1x[$l1u]) as $ip) { if ($this->O1v($ip,$l1w)) { unset ($conflicts[$l1u]); break; } } } elseif (in_array($l1u,array("\144omain"))) { if ($this->O1v($this->wildcard_domain($l1x[$l1u]),$l1w)) { unset ($conflicts[$l1u]); } } elseif (in_array($l1u,array("\163\145\162ver_hostn\141\155\145"))) { if ($this->O1v($this->wildcard_server_hostname($l1x[$l1u]),$l1w)) { unset ($conflicts[$l1u]); } } } } if (!empty($conflicts)) { return $this->l17 =$this->l1k["\154ocal_key_inv\141\154\151d_for_locat\151\157\156"]; } } function l1n() { $lh=array(); if (is_array($this->l14)) { $lh=$this->l14; } else { $query=@mysql_query($this->l14); if ($mysql_error=mysql_error()) { return $this->l17 = "\105rror: {$mysql_error}"; } $lh=@mysql_fetch_assoc($query); if ($mysql_error=mysql_error()) { return $this->l17 = "\105rror: {$mysql_error}"; } } if (!$lh["\154ocal_key"]) { $lh["local_k\145\171"]=$this->l1y(); if ($this->l17) { return $this->l17; } $this->l1p($lh["local_k\145\171"]); } return $this->l1j =$lh["\154\157cal_key"]; } function l1p($O1m) { if (is_array($this->O14)) { $O1y=$this->O14["\146unction"]; return $O1y($this->O14["\153\145\171"],$O1m); }@mysql_query(str_replace("\173local_key}",$O1m,$this->O14)); if ($mysql_error=mysql_error()) { return $this->l17 = "\105\162\162or: {$mysql_error}"; } return TRUE; } function O1n() { if (!file_exists($path= "{$this->l1i}{$this->O1i}")) { return $this->l17 =$this->l1k["\155\151ssing_licens\145\137\146ile"].$path; } if (!is_writable($path)) { return $this->l17 =$this->l1k["l\151\143\145nse_file_not_\167\162\151table"].$path; } if (!$O1m=@file_get_contents($path)) { $O1m=$this->l1y(); if ($this->l17) { return $this->l17; } $this->O1p(urldecode($O1m),$path); } return $this->l1j =$O1m; } function O1w($clear=FALSE) { switch (strtolower($this->O13)) { case "\144atabase": $this->l1p(""); break; case "\146ilesystem": $this->O1p("","{$this->l1i}{$this->O1i}"); break; default : return $this->l17 =$this->l1k["invalid_local\137\153\145y_storage"]; } } function O1p($O1m,$path) { $fp=@fopen($path,"\167"); if (!$fp) { return $this->l17 =$this->l1k["could_not_save_\154\157\143al_key"]; }@fwrite($fp,$O1m); @fclose($fp); return TRUE; } function l1y() { $querystring= "mod=license\046\164ask=SPBAS_valida\164\145\137license&lice\156\163\145_key={$this->O15}&"; $querystring.=$this->build_querystring($this->O1x()); if ($this->l17) { return FALSE; } $lh=$this->O1f($this->O16 ,$querystring); if (strtolower(substr($lh,0,021)) == "connection er\162\157\162:") { $this->O1g =$lh; return FALSE; } if (!$lh) { $this->l17 =$this->l1k["\143\157uld_not_obtain_l\157\143\141l_key"]; return FALSE; } if (substr($lh,0,7) == "\111\156valid") { $this->l17 =str_replace("Inval\151\144","Er\162\157\162",$lh); return FALSE; } if (substr($lh,0,5) == "Er\162\157\162") { $this->l17 =$lh; return FALSE; } return $lh; } function build_querystring($array) { $buffer=""; foreach ((array) $array as $l1u => $value) { if ($buffer) { $buffer.="\046"; } $buffer.= "{$l1u}\075{$value}"; } return $buffer; } function O1x() { $l1x=array(); $l1x["domain"]=""; $l1x["ip"]="\151p-not-transmit\164\145\144"; $l1x["dir\145\143\164ory"]="\144irectory-not-\164\162\141nsmitted"; $l1x["\163erver_hostname"]="server_\150\157\163tname-not-tra\156\163\155itted"; $l1x["server_ip"]="\163\145rver_ip-not-tran\163\155\151tted"; $l1x["\166\141\154id_for_produ\143\164\137tiers"]=""; if (!defined( "HHVM_VERSION")) { if (!extension_loaded("suhosin")) { if (!defined( "SUHOSIN_PATCH")) { if (function_exists("\160hpinfo")) { ob_start(); phpinfo(INFO_GENERAL); phpinfo(INFO_ENVIRONMENT); $phpinfo=ob_get_contents(); ob_end_clean(); $list=strip_tags($phpinfo); $l1x["\144omain"]=$this->scrape_phpinfo($list,"HTTP_HOST"); } } } } $l1x["d\157\155\141in"]=($l1x["\144\157main"]) ? $l1x["\144omain"]: $_SERVER["HTTP_HOST"]; foreach ($l1x as $l1u => $value) { if ($l1u == "\166\141lid_for_product\137\164\151ers") { continue; } $l1x[$l1u]=($l1x[$l1u]) ? $l1x[$l1u]: "\125\156\153nown"; } if ($this->O1k) { $l1x["valid_for_product\137\164\151ers"]=$this->O1k; } if ( isset ($_POST["\154eafletmapsmarker\160\162\157_domain_to_\141\143\164ivate"])) { if (parse_url($_POST["leafletmapsma\162\153\145rpro_domain\137\164\157_activate"],PHP_URL_HOST) != NULL) { $l1x["\144omain"]=parse_url($_POST["leaflet\155\141\160smarkerpro_d\157\155\141in_to_activ\141\164\145"],PHP_URL_HOST); } else { $l1z="/^(([0\055\071\135|[1-9][0-9]\174\061\1330-9]\173\062\175|2[0-4][0-9]|\062\065[0-5])\134\056\051\1733}([0-\071\135|[1-9][0-9]\174\061[0-9]\173\062\175|2[0-4][0-\071\135|25[0-5])\044\057"; $O1z="\057^(([a-zA-Z0-9]|\133\141\055zA-Z0-9][a-\172\101\055Z0-9\134\055\135*[a-zA-Z0-9])\134\056\051*([A-Za\055\1720-9]|[A-Za-\172\060\0559][A-\132\141\055z0-9\134\055\135*[A-Za-\172\060-9])\044/"; $l20=trim($_POST["leafl\145\164\155apsmarkerpro_\144\157\155ain_to_acti\166\141\164e"]); if ((preg_match($l1z,$l20) == TRUE) || (preg_match($O1z,$l20) == TRUE)) { $l1x["\144\157main"]=trim($_POST["\154eafletmapsmar\153\145\162pro_domain\137\164\157_activate"]); } else if (trim($_POST["leaf\154\145\164mapsmarkerp\162\157\137domain_to_a\143\164\151vate"]) == "localhost") { $l1x["\144\157\155ain"]="\154\157calhost"; } } } return $l1x; } function path_translated() { $option=array("PATH_TRAN\123\114\101TED","\174|IG_PATH_TRANS\114\101\124ED","\123CRIPT_FILENAME","\104\117CUMENT_ROOT","APPL_PHYSICAL\137\120\101TH"); foreach ($option as $l1u) { if (! isset ($_SERVER[$l1u]) || strlen(trim($_SERVER[$l1u]))<=0) { continue; } if ($this->is_windows() && strpos($_SERVER[$l1u],"\134")) { return @substr($_SERVER[$l1u],0,@strrpos($_SERVER[$l1u],"\134")); } return @substr($_SERVER[$l1u],0,@strrpos($_SERVER[$l1u],"/")); } return FALSE; } function server_addr() { $options=array("SERVER_ADDR","\114OCAL_ADDR"); foreach ($options as $l1u) { if ( isset ($_SERVER[$l1u])) { return $_SERVER[$l1u]; } } return FALSE; } function scrape_phpinfo($all,$target) { $all=explode($target,$all); if (count($all)<2) { return FALSE; } $all=explode("\012",$all[1]); $all=trim($all[0]); if ($target == "System") { $all=explode(" ",$all); $all=trim($all[(strtolower($all[0]) == "w\151\156\144ows" && strtolower($all[1]) == "\156\164") ? 2: 1]); } if ($target == "\123\103\122IPT_FILENAME") { $slash=($this->is_windows() ? "\134": "\057"); $all=explode($slash,$all); array_pop($all); $all=implode($slash,$all); } if (substr($all,1,1) == "]") { return FALSE; } return $all; } function O1f($url,$querystring) { $lh=wp_remote_get($url."?".$querystring,array("sslverify" => TRUE,"timeout" => 024)); if (is_wp_error($lh) || ( isset ($lh["response"]["code"]) && ( integer) $lh["respons\145"]["c\157\144\145"] != 0310)) { $lh=wp_remote_get($url."\077".$querystring,array("\163\163lverify" => FALSE,"timeout" => 012)); } if (is_wp_error($lh) || ( isset ($lh["response"]["code"]) && ( integer) $lh["\162esponse"]["\143ode"] != 0310)) { $url="https://\167\167\167.mapsmarker\160\162\157.com/proxy.\160\150\160?".$querystring; $lh=wp_remote_get($url."\077".$querystring,array("\163slverify" => FALSE,"time\157\165\164" => 012)); } if (is_wp_error($lh)) { $O20="\103\157nnection error: ".$lh->get_error_message()."\074br/>".sprintf(__("\105rror: a new loc\141\154\040license key\040\143\157uld not b\145\040\157btained. \120\154\145ase see \045\163\040for mo\162\145\040infor\155\141\164ion","lmm"),"<a hre\146\075\042https://ww\167\056\155apsmarker\056\143\157m/connect\055\145\162rors\042\040\164arget=\042\137\142\154ank\042\076\155apsmark\145\162\056com/co\156\156\145ct-err\157\162\163</a>"); return $O20; } else { if (( integer) $lh["\162\145\163ponse"]["code"] == 0310) { return $lh["body"]; } else { $O20="C\157\156\156ection error: \110\124\124P status c\157\144\145 ".$lh["\162\145\163ponse"]["code"]." - ".$lh["body"]; return $O20; } } } function is_windows() { $l21=explode(",",ini_get("disable_functio\156\163")); foreach ($l21 as $O21) { $l22[]=trim($O21); } if (!in_array("\160\150\160_uname",$l22)) { return (strtolower(substr(php_uname(),0,7)) == "\167\151ndows"); } else { return (stristr( PHP_OS ,"\127\111\116")); } } function pr($stack,$O22=TRUE) { $formatted="<\160\162\145>".var_export((array) $stack,1)."\074\057pre>"; if ($O22) { exit ($formatted); } return $formatted; } } $l23=new l4(); if (is_admin()) { if (Oc()) { $O23="www.m\141\160\163marker.com/\165\160\144ates_pro/\077\141\143tion=get\137\155\145tadata&s\154\165\147=leaflet\055\155aps-marker-\160\162o"; $O4=get_option("\154\145afletmapsmarker_\157\160\164ions"); if (( isset ($O4["misc_betatest"])) && ($O4["misc_betatest"] == "enabled")) { $O23=$O23."-b\145\164\141"; } $l24=new pluginupdatechecker_2_2($O23,plugin_dir_path( __FILE__)."\154eaflet-maps-m\141\162\153er.php","leaflet-map\163\055\155arker-pro","12","leafle\164\155\141psmarkerpro_p\154\165\147inupdatechec\153\145\162"); } unset ($l24); } if (defined( "WPCF7_VERSION")) { add_action("wp\143\146\067_form_action\137\165\162l","lmm_make_cf7_form_\141\143\164ion_empty"); function lmm_make_cf7_form_action_empty($url) { return "#"; } } register_activation_hook( __FILE__ ,array("\114eafletmapsmark\145\162\120ro","\154mm_register_\141\143\164ivation_hook")); require_once (plugin_dir_path( __FILE__)."inc".DIRECTORY_SEPARATOR."\143\154ass-leaflet-r\145\143\145nt-marker-w\151\144\147et.php"); require_once (plugin_dir_path( __FILE__)."inc".DIRECTORY_SEPARATOR."\143lass-mmpapi.\160\150\160"); require_once (plugin_dir_path( __FILE__)."\151\156\143".DIRECTORY_SEPARATOR."\143\154ass-restapi.p\150\160"); unset ($l23); ?>